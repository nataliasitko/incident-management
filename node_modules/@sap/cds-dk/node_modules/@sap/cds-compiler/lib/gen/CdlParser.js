// Parser generated by redepage v0.1.18
'use strict;'
const { XsnSource, XsnArtifact, XsnName } = require( '../compiler/xsn-model' )
const AstBuildingParser = require('../parsers/AstBuildingParser')
const keywords={
abstract:0,
action:0,
actions:0,
all:1,
and:0,
annotate:0,
annotation:0,
any:1,
array:0,
as:1,
asc:0,
aspect:0,
association:0,
between:0,
by:1,
case:1,
cast:1,
columns:0,
composition:0,
context:0,
cross:0,
current:0,
default:0,
define:0,
definitions:0,
desc:0,
distinct:0,
element:0,
elements:0,
else:0,
end:0,
entity:0,
enum:0,
escape:0,
event:0,
exact:0,
except:0,
excluding:0,
exists:1,
extend:0,
false:1,
first:0,
floating:0,
following:0,
from:1,
full:0,
function:0,
group:0,
having:0,
in:1,
inner:0,
intersect:0,
into:0,
is:0,
join:0,
key:1,
last:0,
left:0,
like:0,
limit:0,
localized:0,
many:0,
masked:0,
minus:0,
mixin:0,
namespace:0,
new:0,
not:1,
null:1,
nulls:0,
of:1,
offset:0,
on:1,
one:0,
or:0,
order:0,
outer:0,
over:0,
parameters:0,
partition:0,
preceding:0,
projection:0,
redirected:0,
returns:0,
right:0,
row:0,
rows:0,
select:1,
service:0,
some:1,
stored:0,
then:0,
to:0,
true:1,
type:0,
unbounded:0,
union:0,
up:0,
using:0,
variable:0,
view:0,
virtual:0,
when:0,
where:1,
with:1,
}
const table=[
'start',
{
namespace:[2,16,,'namespaceRestriction'],
using:[2,19],
'@':[2,10,,,,'namespaceRestriction'],type:'@',view:'@',event:'@',action:'@',aspect:'@',define:'@',entity:'@',extend:'@',context:'@',service:'@',abstract:'@',annotate:'@',function:'@',annotation:'@',
'':3
},
{
';':['c',1],
EOF:3,
Id:['g',1,,'afterBrace'],'@':'Id',
},
['m',0,'EOF'],
'artifactsBlock',
['m',6,'{',,,'vocabularyRestriction'],
{Id:[7,10],'@':'Id','':8},
{
';':['c',6],
'}':8,
Id:['g',6,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'artifactDefOrExtend',
{'@':[10,768],'':11},
{
define:['ck',12],
type:12,view:12,event:12,action:12,aspect:12,entity:12,context:12,service:12,abstract:12,function:12,annotation:12,
extend:['ck',13,,'extensionRestriction'],
annotate:['ck',14,,'extensionRestriction'],
},
{
service:[0,44],
context:[0,49],
annotation:[0,54,,'vocabularyRestriction'],
type:[0,59],
aspect:[0,64],abstract:'aspect',
entity:[0,74],
view:[0,88],
event:[0,100],
action:[0,112],
function:[0,118],
},
{
Id:[0,228],
service:[0,250,1],
context:[0,257,1],
type:[0,264,1],
aspect:[0,276,1],entity:'aspect',
projection:[0,287,1],
},
[0,215],
'namespaceDeclaration',
['mk',17,'namespace'],
[0,36],
'usingDeclaration',
['mk',20,'using'],
{
from:['ck',21],
Id:[22,32],
'{':24,
},
['m',0,'String'],
{from:['ck',23],'':0},
['m',0,'String'],
['m',25,'{'],
{Id:26},
{Id:[27,32],'':28},
{
',':['c',26],
'}':28,
},
['m',29,'}',,,'afterBrace'],
{from:['ck',30],'':0},
['m',0,'String'],
'usingProxy',
[33,40],
{as:['ck',34],'':0},
['mi',0],
'namePath',
['mi',37],
{'.':['c',38],'':0},
['miA',37],
'simplePath',
['mi',41],
{'.':['c',42],'':0},
['miA',41],
'serviceDef',
['mk',45,'service'],
[46,36],
{'@':[46,774],'':47},
{'{':[0,5],'':0},
'contextDef',
['mk',50,'context'],
[51,36],
{'@':[51,774],'':52},
{'{':[0,5],'':0},
'annotationDef',
['mk',55,'annotation'],
[56,36],
{'@':[56,774],'':57},
[0,346],
'typeDef',
['mk',60,'type'],
[61,36],
{'@':[61,774],'':62},
[0,346],
'aspectDef',
{
aspect:['ck',66],
abstract:['ck',65],
},
['mk',66,'entity'],
[67,36],
{'@':[67,774],'':68},
{
'{':[72,157],
':':['c',69],
'':0
},
{Id:[70,40],'':71},
{
',':['c',69],
'{':71,
'':0
},
[72,157],
{actions:[0,124],'':0},
'entityDef',
['mk',75,'entity'],
[76,36],
{'@':[76,774],'':77},
{'(':[78,141],'':78},
{
':':['c',79],
'{':82,
as:['ck',83],
},
{Id:80},
{Id:[81,40],'':82},
{
',':['c',80],
'{':82,
},
[86,157],
{
'(':[86,451],select:'(',
projection:[84,445],
},
{group:[85,601],where:'group',having:'group','':85},
{limit:[86,613],order:'limit','':86},
{actions:[0,124],'':0},
'viewDef',
['mk',89,'view'],
[90,36],
{'@':[90,774],'':91},
{
'(':[97,141],
with:['ck',92],
'':97
},
['mk',93,'parameters'],
[94,146],
{',':['c',95],'':96},
[94,146],
['g',97],
['mk',98,'as'],
[0,451],
'eventDef',
['mk',101,'event'],
[102,36],
{'@':[102,774],'':103},
{
'{':[0,157],
':':['c',104],
},
{
'{':[0,157],
Id:[105,40],
projection:[0,445,1],
},
{',':106,'{':106,'':110},
{',':['c',107],'':109},
{Id:[108,40],'':109},
{
',':['c',107],
'{':109,
},
[0,157],
{'@':[110,768],'':0},
'actionMainDef',
['mk',113,'action'],
[114,36],
{'@':[114,774],'':115},
[116,141],
{returns:[0,153],'':0},
'functionMainDef',
['mk',119,'function'],
[120,36],
{'@':[120,774],'':121},
[122,141],
[0,153],
'actionsBlock',
['mk',125,'actions'],
['m',126,'{'],
{Id:[127,130],'@':'Id','':128},
{
';':['c',126],
'}':128,
Id:['g',126,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'boundActionFunctionDef',
{'@':[130,768],'':131},
{
action:['ck',132],
function:['ck',136],
},
['mi',133],
{'@':[133,774],'':134},
[135,141],
{returns:[0,153],'':0},
['mi',137],
{'@':[137,774],'':138},
[139,141],
[0,153],
'paramsList',
['m',142,'('],
{Id:[143,146],'@':'Id','':144},
{
',':['c',142],
')':144,
},
['m',0,')'],
'paramDef',
{'@':[146,768],'':147},
['miA',148],
{'@':[148,774],'':149},
{
'{':[150,157],
':':['c',151],
},
{not:[0,438],null:'not','':0},
[0,357],
'returnsSpec',
['mk',154,'returns',,'default','elementRestriction'],
{'@':[154,768],'':155},
[0,357],
'elementsBlock',
['m',158,'{'],
{Id:[159,162],'@':'Id','':160},
{
';':['c',158],
'}':160,
Id:['g',158,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'elementDef',
{'@':[162,768],'':163},
{virtual:['ck',164,1],'':164},
{key:['ck',165],'':165},
{masked:['ck',166,1],'':166},
{element:['ck',167,1],'':167},
['mi',168,,,'elem','elementRestriction'],
{'@':[168,774],'':169},
{
'{':[170,157],
':':['c',171],
'':172
},
{not:[172,438],null:'not','':172},
[172,357],
{'=':['c',173,,'elementRestriction','calc'],'':0},
[174,641],
{stored:['ck',175],'':175},
['g',176],
{'@':[176,768,,'elementRestriction','anno'],'':0},
'enumSymbolsBlock',
['mk',179,'enum'],
['m',180,'{'],
{Id:[181,184],'@':'Id','':182},
{
';':['c',180],
'}':182,
},
['m',0,'}',,,'afterBrace'],
'enumSymbolDef',
{'@':[184,768],'':185},
['mi',186],
{'@':[186,768],'':187},
{'=':['c',188],'':0},
{
String:['c',190],
Number:['c',190],
'+':['c',189],'-':'+',
Id:[190,765],'#':'Id',QuotedLiteral:'Id',
},
['m',190,'Number'],
['g',191],
{'@':[191,768],'':0},
'foreignKeysBlock',
['m',194,'{'],
{Id:[195,198],'@':'Id','':196},
{
',':['c',194],
'}':196,
},
['m',0,'}'],
'foreignKeyDef',
{'@':[198,768],'':199},
[200,40],
{as:['ck',201],'':0},
['mi',0],
'mixinElementDef',
['mi',204],
['m',205,':'],
{
association:['ck',206],
composition:['ck',208],
},
{'[':[207,426],'':207},
['mk',210,'to'],
{'[':[209,426],'':209},
['mk',210,'of'],
{one:['ck',211,1],many:'one','':211},
[212,40],
['mk',213,'on'],
[0,633],
'annotateArtifact',
[216,36],
{
':':['c',217],
with:['ck',222],
'':222
},
[218,36],
{with:['ck',219],'':219},
['g',220],
{'@':[220,768],'':221},
{'{':[0,320],'':0},
['g',223],
{'@':[223,768],'':224},
{'(':[225,307],'':225},
{
returns:[0,316],
'{':[226,320],
'':226
},
{actions:[0,295],'':0},
'extendArtifact',
[229,36],
{
':':['c',230],
with:['ck',239],
'':236
},
[231,36],
{with:['ck',232],'':232},
['g',233],
{'@':[233,768],'':234},
{
elements:['ck',235],
'{':235,
enum:[0,178],
'(':[0,417],
'':0
},
[0,330],
{'@':[236,768],'':237},
{'{':[238,330],'':0},
{actions:[0,124],'':0},
{'@':[239,768],'':240},
{
Id:[241,40],
elements:['ck',245,1],
'{':245,
actions:[0,124,1],
enum:[0,178,1],
'(':[0,417],
columns:['ck',247,1],
definitions:['ck',248,1],
'':0
},
{',':['c',242],'':243},
[241,40],
{'{':[244,330],'':244},
{actions:[0,124],'':0},
[246,330],
{actions:[0,124],'':0},
[0,557],
[0,5],
'extendService',
['mk',251,'service'],
[252,36],
{with:['ck',253],'':253},
['g',254],
{'@':[254,768],'':255},
{'{':[0,5],'':0},
'extendContext',
['mk',258,'context'],
[259,36],
{with:['ck',260],'':260},
['g',261],
{'@':[261,768],'':262},
{'{':[0,5],'':0},
'extendType',
['mk',265,'type'],
[266,36],
{with:['ck',269],'':267},
{'@':[267,768],'':268},
{'{':[0,330],'':0},
{'@':[269,768],'':270},
{
Id:[271,40],
elements:['ck',274,1],
'{':274,
enum:[0,178,1],
'(':[0,417],
'':0
},
{',':['c',272],'':273},
[271,40],
{'{':[0,330],'':0},
[0,330],
'extendEntityOrAspect',
{aspect:['ck',277],entity:'aspect'},
[278,36],
{with:['ck',280],'':279},
{'@':[279,768],'':284},
{'@':[280,768],'':281},
{
Id:[282,40],
actions:['g',284,1],
'':284
},
{',':['c',283],'':284},
[282,40],
{'{':[285,330],'':285},
{actions:[0,124],'':0},
'extendProjection',
['mk',288,'projection'],
[289,36],
{with:['ck',290],'':290},
['g',291],
{'@':[291,768],'':292},
{'{':[293,557],'':293},
{actions:[0,124],'':0},
'annotateActionsBlock',
['mk',296,'actions'],
['m',297,'{'],
{Id:[298,301],'@':'Id','':299},
{
';':['c',297],
'}':299,
Id:['g',297,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'annotateBoundAction',
{'@':[301,768],'':302},
['mi',303],
{'@':[303,768],'':304},
{'(':[305,307],'':305},
{returns:[0,316,1],'':0},
'annotateParamsBlock',
['m',308,'('],
{Id:[309,312],'@':'Id','':310},
{
',':['c',308],
')':310,
},
['m',0,')'],
'annotateParam',
{'@':[312,768],'':313},
['mi',314],
{'@':[314,768],'':0},
'annotateReturns',
['mk',317,'returns'],
{'@':[317,768],'':318},
{'{':[0,320],'':0},
'annotateElementsBlock',
['m',321,'{'],
{Id:[322,325],'@':'Id','':323},
{
';':['c',321],
'}':323,
Id:['g',321,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'annotateElement',
{'@':[325,768],'':326},
['mi',327],
{'@':[327,768],'':328},
{'{':[0,320],'':0},
'extendElementsBlock',
['m',331,'{'],
{Id:[332,335],'@':'Id','':333},
{
';':['c',331],
'}':333,
Id:['g',331,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'elementDefOrExtend',
{'@':[335,768],'':336},
{
Id:[0,162],'@':'Id',key:'Id',
extend:['ck',337,1],
},
{element:['ck',338,1],'':338},
['mi',339],
{with:['ck',342],'':340},
{'@':[340,768],'':341},
{'{':[0,330],'':0},
{'@':[342,768],'':343},
{
elements:['ck',344],
'{':344,
enum:[0,178],
'(':[0,417],
'':0
},
[0,330],
'typeOrIncludesSpec',
{
'{':[347,157],
':':['c',348],
},
{not:[0,438],null:'not','':0},
{
'{':[0,357,1],many:'{',type:'{',array:'{',localized:'{',association:'{',composition:'{',
Id:[349,40],
},
{
'(':[350,405],':':'(',
'@':[0,358],not:'@',enum:'@',null:'@',default:'@',
',':351,'{':351,
'':0
},
{'@':[0,358],not:'@',enum:'@',null:'@',default:'@','':0},
{',':['c',352],'':354},
{Id:[353,40],'':354},
{
',':['c',352],
'{':354,
},
[355,157],
{not:[0,438],null:'not','':0},
'typeExpression',
{
Id:[358,404],
type:[358,396,1],
localized:['ck',367,1],
association:['ck',369,1,,'calc','elementRestriction'],
composition:['ck',373,1,,'calc','elementRestriction'],
array:['ck',377,1,,'calc','elementRestriction'],
many:['ck',378,1,,'calc','elementRestriction'],
'{':[384,157,,,'calc','elementRestriction'],
},
['g',359],
{'@':[359,768],'':360},
{not:[361,438,,'elementRestriction','notNull'],null:'not','':362},
{'@':[361,768],'':362},
{
enum:[363,178,,,'anno','elementRestriction'],
'@':[0,393],not:'@',null:'@',default:'@',
'':0
},
{not:[364,438,,'elementRestriction','notNull'],null:'not','':364},
{default:['ck',365,,'elementRestriction','default'],'':366},
[366,641],
{not:[0,438,,'elementRestriction','notNull'],null:'not','':0},
[368,404],
{'@':[0,393],not:'@',null:'@',default:'@','':0},
{'[':[370,426],'':370},
['mk',371,'to'],
{one:['ck',372,1],many:'one','':372},
[0,386],
{'[':[374,426],'':374},
['mk',375,'of'],
{one:['ck',376,1],many:'one','':376},
{
Id:[0,386],
'{':[0,157],
},
['mk',378,'of'],
{
Id:[379,404],
type:[379,396,1],
'{':[383,157],
},
{not:[380,438,,'elementRestriction','notNull'],null:'not','':380},
{enum:[383,178],'':381},
{'@':[381,768],'':382},
['g',0,[]],
{not:[0,438,,'elementRestriction','notNull'],null:'not','':0},
{not:[0,438],null:'not','':0},
'typeAssocProperties',
[387,40],
{'@':[387,768],'':388},
{
on:['ck',389],
'{':[391,193],
'@':[0,393],not:'@',null:'@',default:'@',
'':0
},
[390,633],
{'@':[390,768],'':0},
{'@':[0,393],not:'@',null:'@',default:'@','':0},
'typeProperties',
{
'@':[393,768],
not:[393,438,,'elementRestriction','notNull'],null:'not',
default:['ck',394,,'elementRestriction','default'],
'':0
},
[393,641],
'typeTypeOf',
['mk',397,'type'],
['mk',398,'of'],
[399,40],
{':':['c',400],'':0},
['miA',401],
{'.':['c',402],'':0},
['miA',401],
'typeRefOptArgs',
[405,40],
{
':':['c',406],
'(':['c',409],
'':0
},
['miA',407],
{'.':['c',408],'':0},
['miA',407],
{
Number:['c',410],
Id:413,
},
{',':['c',411],'':412},
{
Number:['c',410],
floating:['ck',410],variable:'floating',
')':412,
},
['g',415],
{Id:[414,422],'':415},
{
',':['c',413],
')':415,
},
['m',0,')'],
'typeNamedArgsList',
['m',418,'('],
{Id:[419,422],'':420},
{
',':['c',418],
')':420,
},
['m',0,')'],
'typeNamedArg',
['mi',423],
['m',424,':'],
{
Number:['c',0],
floating:['ck',0],variable:'floating',
},
'cardinality',
['m',427,'['],
{
'*':['c',428],
Number:['c',430],
'':432
},
{',':['c',429],'':432},
[432,434],
{
',':['c',431],
'..':[432,435],
'':432
},
[432,434],
['m',0,']'],
'targetCardinality',
{
'*':['c',0],
Number:['c',435],
},
{'..':['c',436],'':0},
{
'*':['c',0],
Number:['c',0],
},
'nullability',
{
null:['ck',0],
not:['ck',439],
},
['mk',0,'null'],
'queryEOF',
[442,451],
{';':['c',443],'':443},
['m',0,'EOF'],
'projectionSpec',
['mk',446,'projection'],
['mk',447,'on'],
[448,511],
{'{':[449,557],'':449},
{excluding:[0,550],'':0},
'queryExpression',
{
'(':['c',452],
Id:[454,461],
},
[453,451],
['m',454,')'],
{
intersect:['ck',455,,'precLeft_',4],
minus:['ck',455,,'precLeft_',2],except:'minus',
union:['ck',456,,'precLeft_',2],
'':458
},
{distinct:['ck',457],'':457},
{all:['ck',457],distinct:'all','':457},
[454,451],
{limit:['g',459,,'precPost_',0],order:'limit','':0},
[0,613],
'selectQuery',
['mk',462,'select'],
{
from:['ck',463],
all:['ck',473,1],distinct:'all',
Id:473,'#':473,'(':473,'*':473,'+':473,'-':473,':':473,'?':473,'@':473,'{':473,key:473,not:473,case:473,cast:473,null:473,true:473,false:473,Number:473,String:473,exists:473,QuotedLiteral:473,
},
[464,480],
{mixin:['ck',465],'':470},
['m',466,'{'],
{Id:[467,203],'':468},
{
';':['c',466],
'}':468,
},
['m',469,'}'],
['mk',470,'into'],
{all:['ck',471],distinct:'all','':471},
{'{':[472,557],'':472},
{excluding:[478,550],'':478},
{
'*':['c',474],
Id:[474,567],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
},
{',':['c',475],'':476},
{
'*':['c',474],
Id:[474,567],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
},
['mk',477,'from'],
[478,480],
{group:[0,601],where:'group',having:'group','':0},
'querySource',
[481,485],
{',':482,'':0},
{',':['c',483],'':0},
[482,485],
'tableExpression',
{
'(':[486,498],
Id:[487,511],
},
['g',487],
{
cross:['ck',488],
inner:['ck',491],
full:['ck',490],left:'full',right:'full',
join:['ck',493],
'':0
},
['mk',489,'join'],
{
'(':[487,498],
Id:[487,511],
},
{outer:['ck',491],'':491},
{one:[492,505],many:'one',exact:'one','':492},
['mk',493,'join'],
['g',494],
[495,485],
['mk',496,'on'],
[487,633],
'tableOrQueryParens',
['m',499,'(',,,'queryOnLeft'],
{
'(':[500,498],
Id:[501,485,,,'table','queryOnLeft'],
select:[501,451],
},
{
full:[501,486,,,'table','queryOnLeft'],join:'full',left:'full',cross:'full',inner:'full',right:'full',
limit:[501,454,,'queryOnLeft'],minus:'limit',order:'limit',union:'limit',except:'limit',intersect:'limit',
'':501
},
['m',502,')'],
{
as:['ck',503,,'queryOnLeft','table'],
Id:['ci',0,,'queryOnLeft','tableWithoutAs'],
'':0
},
['mi',0],
'joinCardinality',
{
exact:['ck',506],
one:506,
many:['ck',507],
},
['mk',507,'one'],
['mk',508,'to'],
{
exact:['ck',509],
one:509,
many:['ck',0],
},
['mk',0,'one'],
'fromRefWithOptAlias',
[512,518],
{':':['c',513],'':514},
[514,518],
{
as:['ck',515],
Id:['ci',0,,'tableWithoutAs'],
'':516
},
['mi',0],
['g',0,[]],
'fromPath',
['mi',519],
{'(':[520,524],'[':'(','':520},
{'.':['c',521],'':0},
['miA',522],
{'(':[520,524],'[':'(','':520},
'fromArgumentsAndFilter',
{'(':['c',525],'':529},
{Id:526},
{Id:[527,531],'':528},
{
',':['c',526],
')':528,
},
['m',529,')'],
{'[':[0,535],'':0},
'fromNamedArgument',
['mi',532],
['m',533,':'],
[0,641],
'cardinalityAndFilter',
['m',536,'['],
{Number:['c',537,,'beforeColon'],'':538},
['m',538,':'],
[539,541],
['m',0,']'],
'filterClauses',
{
where:['ck',542],
Id:542,'#':542,'(':542,'+':542,'-':542,':':542,'?':542,not:542,case:542,cast:542,null:542,true:542,false:542,Number:542,String:542,exists:542,QuotedLiteral:542,
group:['g',543,1],limit:'group',order:'group',having:'group',
'':543
},
[543,633],
{group:544,'':545},
[545,607],
{having:['ck',546],'':547},
[547,633],
{limit:548,order:548,'':0},
[0,613],
'excludingClause',
['mk',551,'excluding'],
['m',552,'{'],
{Id:553},
{Id:['ciA',554],'':555},
{
',':['c',553],
'}':555,
},
['m',0,'}',,,'afterBrace'],
'selectItemsList',
['m',558,'{',,'top','inSelectItem'],
{
'*':['c',559],
Id:[559,567],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'':560
},
{
',':['c',558],
'}':560,
},
['m',0,'}',,,'afterBrace'],
'nestedSelectItemsList',
['m',563,'{',,'nested','inSelectItem'],
{
'*':['c',564],
Id:[564,567],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'':565
},
{
',':['c',563],
'}':565,
},
['m',0,'}',,,'afterBrace'],
'selectItemDef',
{'@':[567,771],'':568},
{virtual:['ck',569,1,'modifierRestriction'],'':569},
{key:['ck',570,,'modifierRestriction'],'':570},
{
Id:[571,641],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'{':[578,562],
},
{
as:['ck',572],
Id:['ci',573],
'':573
},
['mi',573],
{
'{':574,
'.':['c',576],
'':581
},
[575,562],
{excluding:[581,550],'':581},
{
'{':[577,562],
'*':['c',581],
},
{excluding:[581,550],'':581},
{excluding:[579,550],'':579},
['mk',580,'as'],
['mi',581],
['g',582],
{'@':[582,774],'':583},
{':':['c',584],'':0},
{
type:[598,396,1],
localized:['ck',585,1],
Id:585,
redirected:['ck',586,1],
association:['ck',590,1],
composition:['ck',592,1],
},
[598,404],
['mk',587,'to'],
[588,40],
{
on:['ck',589],
'{':[598,193],
'':598
},
[598,633],
{'[':[591,426],'':591},
['mk',594,'to'],
{'[':[593,426],'':593},
['mk',594,'of'],
{one:['ck',595,1],many:'one','':595},
[596,40],
['mk',597,'on'],
[598,633],
['g',599],
{'@':[599,768],'':0},
'whereGroupByHaving',
{where:['ck',602],'':603},
[603,633],
{group:[604,607],'':604},
{having:['ck',605],'':0},
[0,633],
'groupByClause',
['mk',608,'group'],
['mk',609,'by'],
[610,641],
{',':['c',611],'':0},
[610,641],
'orderByLimitOffset',
{order:[614,619],'':614},
{limit:['ck',615],'':0},
[616,641],
{offset:['ck',617],'':0},
[0,641],
'orderByClause',
['mk',620,'order'],
['mk',621,'by'],
[622,625],
{',':['c',623],'':0},
[622,625],
'orderByExpression',
[626,641],
{asc:['ck',627],desc:'asc','':627},
{nulls:['ck',628],'':0},
{last:['ck',0],first:'last'},
'conditionEOF',
[631,641],
['m',0,'EOF'],
'condition',
[0,641],
'valuePath',
['mi',636],
{'(':[637,702],'[':'(','':637},
{'.':['c',638,,'isDotForPath'],'':0},
['miA',639],
{'(':[637,702],'[':'(','':637},
'expression',
{
'(':[642,669],
'#':[652,765],null:'#',true:'#',false:'#',Number:'#',String:'#',QuotedLiteral:'#',
':':['c',643],
'?':['c',652],
Id:[645,635],
new:[652,681,1],
exists:['ck',648],
case:[652,684],
cast:[652,695],
'+':['c',651,,'precRight_',30],'-':'+',
not:['ck',651,,'precRight_',8],
},
['g',652],
{
Id:['ciA',644],
Number:['c',652],
},
{'.':[652,637],'':652},
{over:['ck',646],'':647},
[647,729],
['g',652],
{
'(':['c',649],
Id:[652,635],
'?':['c',652],
},
[650,451],
['m',652,')'],
[652,641],
{
'*':['c',656,,'precLeft_',24],'/':'*',
'+':['c',656,,'precLeft_',22],'-':'+',
'||':['c',656,,'precLeft_',20],
and:['ck',656,,'precLeft_',4],
or:['ck',656,,'precLeft_',2],
'?':['c',653,,'precLeft_',0],
'<':['c',655,,'precNone_',10],'=':'<','>':'<','!=':'<','<=':'<','<>':'<','>=':'<',
is:['ck',657,,'precNone_',10],
not:['ck',659,,'isNegatedRelation','10'],
in:['g',659,,'precNone_',10],like:'in',between:'in',
'':0
},
[654,641],
['m',656,':'],
{all:['ck',656],any:'all',some:'all','':656},
[667,641],
{not:['ck',658],'':658},
['mk',667,'null'],
{
between:['ck',660],
in:['ck',663],
like:['ck',664],
},
[661,641],
['mk',662,'and'],
[667,641],
[667,641],
[665,641],
{escape:['ck',666],'':667},
[667,641],
['g',652],
'expressionOrQueryParens',
['m',670,'(',,,'queryOnLeft'],
{
'(':[671,669],
Id:[673,641,,,'expr','queryOnLeft'],'#':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id',
select:[674,451],
},
{
'*':[672,642,,,'expr','queryOnLeft'],'+':'*','-':'*','/':'*','<':'*','=':'*','>':'*','?':'*','!=':'*','<=':'*','<>':'*','>=':'*',in:'*',is:'*',or:'*','||':'*',and:'*',not:'*',like:'*',between:'*',
',':[674,676,,,'expr','queryOnLeft'],
limit:[674,454,,'queryOnLeft'],minus:'limit',order:'limit',union:'limit',except:'limit',intersect:'limit',
'':674
},
{',':[674,676],'':674},
{',':[674,676],'':674},
['m',0,')'],
'continueExpressionslist',
['m',677,','],
{Id:678,'#':678,'(':678,'+':678,'-':678,':':678,'?':678,not:678,case:678,cast:678,null:678,true:678,false:678,Number:678,String:678,exists:678,QuotedLiteral:678},
{Id:[679,641],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id','':0},
{',':['c',678],'':0},
'newAndValuePath',
['mk',682,'new'],
[0,635],
'caseExpression',
['mk',685,'case'],
{
Id:[686,641],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id',
when:['g',686,1],
'':686
},
{when:687},
{when:['ck',688],'':691},
[689,641],
['mk',690,'then'],
[687,641],
{else:['ck',692],'':693},
[693,641],
['mk',0,'end'],
'castFunction',
['mk',696,'cast'],
['m',697,'('],
[698,641],
['mk',699,'as'],
[700,404],
['m',0,')'],
'argumentsAndFilter',
{'(':['c',703,,,,'prepareSpecialFunction'],'':722},
{Id:['ciA',710,,'isNamedArg'],'':704},
{Id:[705,724],'#':'Id','(':'Id','*':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Id_all:'Id',Number:'Id',String:'Id',QuotedLiteral:'Id','':721},
{',':['c',706,,,,'nextFunctionArgument'],'':707},
{
Id:[705,724],'#':'Id','(':'Id','*':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Id_all:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id',
')':['g',707,1],order:')',
},
{order:['ck',708],'':721},
['mk',709,'by'],
[721,744],
{
':':['c',711],
'=>':['c',716],
},
[712,641],
{',':['c',713],'':721},
{
Id:['ciA',714],
')':721,
},
['m',715,':'],
[712,641],
[717,641],
{',':['c',718],'':721},
{
Id:['ciA',719],
')':721,
},
['m',720,'=>'],
[717,641],
['m',722,')'],
{'[':[0,535],'':0},
'funcExpression',
{
' lookahead':'lGenericIntroOrExpr',
Id:[726,641],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
GenericExpr:['ckA',726],
GenericIntro:['ckA',725],
},
[726,641],
{
' lookahead':'lGenericSeparator',
GenericSeparator:['ckA',727],
'':0
},
{
' lookahead':'lGenericExpr',
Id:[726,641],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
GenericExpr:['ckA',726],
},
'overClause',
['m',730,'('],
{partition:['ck',731],'':733},
['mk',732,'by'],
[733,740],
{order:['ck',734],'':736},
['mk',735,'by'],
[736,744],
{rows:['ck',737],'':738},
[738,753],
['m',0,')'],
'expressionsAsXpr',
[741,641],
{',':['c',742],'':0},
[741,641],
'orderByClauseAsXpr',
[745,748],
{',':['c',746],'':0},
[745,748],
'orderBySpecAsXpr',
[749,641],
{asc:['ck',750],desc:'asc','':750},
{nulls:['ck',751],'':0},
{last:['ck',0],first:'last'},
'windowFrameClause',
{
unbounded:['ck',754],
Number:['c',754],
current:['ck',755],
between:['ck',756],
},
['mk',0,'preceding'],
['mk',0,'row'],
[757,760],
['mk',758,'and'],
[0,760],
'windowFrameBoundSpec',
{
unbounded:['ck',761],
Number:['c',761],
current:['ck',763],
},
{
following:['ck',762],
preceding:['ck',762],
},
['g',0,[]],
['mk',0,'row'],
'literalValue',
{
'#':['c',766],
null:['ck',0],
true:['ck',0],false:'true',
Number:['c',0],
String:['c',0],
QuotedLiteral:['c',0],
},
['mi',0],
'annoAssignStd',
['m',769,'@',,,'annoInSameLine'],
{
'(':[0,777],
Id:[0,782],
},
'annoAssignCol',
['m',772,'@'],
{
'(':[0,777],
Id:[0,782],
},
'annoAssignMid',
['m',775,'@',,,'annoInSameLine'],
{
'(':[0,777],
Id:[0,786],
},
'annoAssignParen',
['m',778,'(',,,'annoInSameLine'],
{Id:[779,782],'':780},
{
',':['c',778],
')':780,
},
['m',0,')'],
'annoAssignBase',
[783,786],
{':':['c',784,,'annoInSameLine'],'':0},
[0,808],
'annoNamePath',
['miA',787],
{'.':['c',788],'':790},
{
Id:['ciA',787],
'@':['c',789],
},
['miA',787],
{'#':[0,799,,'annoInSameLine'],'':0},
'annoPath',
{
Id:['ciA',794],
'@':['c',793],
},
['miA',794],
{'.':['c',795],'':797},
{
Id:['ciA',794],
'@':['c',796],
},
['miA',794],
{'#':[0,799],'':0},
'annoPathVariant',
['m',800,'#'],
['miA',801],
{'.':['c',802],'':0},
['miA',801],
'annoStructValue',
[805,792],
{':':['c',806],'':0},
[0,808],
'annoValue',
{
'#':[0,765],null:'#',true:'#',false:'#',Number:'#',String:'#',QuotedLiteral:'#',
'+':['c',809],'-':'+',
Id:[0,792],'@':'Id',
'{':['c',810],
'[':['c',814,,,,'arrayAnno'],
'(':['c',821],
},
['m',0,'Number'],
{Id:[811,804],'@':'Id','':812},
{
',':['c',810],
'}':812,
},
['g',813],
['m',0,'}'],
{
Id:[819,808],'#':'Id','(':'Id','+':'Id','-':'Id','@':'Id','[':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'...':['c',815,,'arrayAnno','ellipsis'],
'':820
},
{up:['ck',816],'':818},
['mk',817,'to'],
[818,808],
['g',819],
{
',':['c',814],
']':820,
},
['m',0,']'],
[822,633],
['m',0,')'],
]
class CdlParser extends AstBuildingParser{
constructor(lexer,...args){super(lexer,keywords,table,...args)}
start($,$next){
$.source??=new XsnSource( 'cdl' )
this.rule_(1,$next)
for(;;)switch(this.s){
case 1:switch(this.lk()){
case'namespace':this.gc(3,'namespaceRestriction')&&this.namespaceDeclaration({source:$.source},2);continue
case'using':this.usingDeclaration({source:$.source},2);continue
case'@':case'type':case'view':case'event':case'action':case'aspect':case'define':case'entity':case'extend':case'context':case'service':case'abstract':case'annotate':case'function':case'annotation':if(this.artifactDefOrExtend({outer:$.source},2)){this.namespaceRestriction()}continue;
default:this.s=3;continue
}
case 2:switch(this.l()){
case';':this.c(1);continue
case'EOF':this.s=3;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(1)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 3:if(this.m(0,'EOF')){ this.docComment( null ); }continue
default:return this.exit_()
}
}
artifactsBlock($,$next){
this.rule_(5,$next)
for(;;)switch(this.s){
case 5:if(this.m(6,'{')){this.vocabularyRestriction(); $.art.artifacts = this.createDict( $.start ); $.art.extensions = []; }continue
case 6:switch(this.l()){
case'Id':case'@':this.artifactDefOrExtend({outer:$.art},7);continue
default:this.s=8;continue
}
case 7:switch(this.l()){
case';':this.c(6);continue
case'}':this.s=8;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(6)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 8:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.artifacts ); }continue
default:return this.exit_()
}
}
artifactDefOrExtend($,$next){
let art=new XsnArtifact()
this.rule_(10,$next)
{ art.location = this.startLocation();
this.docComment( art ); }
for(;;)switch(this.s){
case 10:switch(this.l()){
case'@':this.annoAssignStd({art},10);continue
default:this.s=11;continue
}
case 11:switch(this.lk()){
case'define':this.ck(12);continue
case'type':case'view':case'event':case'action':case'aspect':case'entity':case'context':case'service':case'abstract':case'function':case'annotation':this.s=12;continue
case'extend':if(this.ec('extensionRestriction')&&this.ck(13)){ art.kind = 'extend'; }continue
case'annotate':this.ec('extensionRestriction')&&this.ck(14);continue
default:this.e();continue
}
case 12:switch(this.lk()){
case'service':this.serviceDef({art,outer:$.outer},0);continue
case'context':this.contextDef({art,outer:$.outer},0);continue
case'annotation':this.ec('vocabularyRestriction')&&this.annotationDef({art,outer:$.outer},0);continue
case'type':this.typeDef({art,outer:$.outer},0);continue
case'aspect':case'abstract':this.aspectDef({art,outer:$.outer},0);continue
case'entity':this.entityDef({art,outer:$.outer},0);continue
case'view':this.viewDef({art,outer:$.outer},0);continue
case'event':this.eventDef({art,outer:$.outer},0);continue
case'action':this.actionMainDef({art,outer:$.outer},0);continue
case'function':this.functionMainDef({art,outer:$.outer},0);continue
default:this.e();continue
}
case 13:switch(this.lk()){
case'Id':this.extendArtifact({art,outer:$.outer},0);continue
case'service':this.lP()&&this.extendService({art,outer:$.outer},0);continue
case'context':this.lP()&&this.extendContext({art,outer:$.outer},0);continue
case'type':this.lP()&&this.extendType({art,outer:$.outer},0);continue
case'aspect':case'entity':this.lP()&&this.extendEntityOrAspect({art,outer:$.outer},0);continue
case'projection':this.lP()&&this.extendProjection({art,outer:$.outer},0);continue
default:this.ei();continue
}
case 14:this.annotateArtifact({art,outer:$.outer},0);continue
default:return this.exit_()
}
}
namespaceDeclaration($,$next){
let name;let _
this.rule_(16,$next)
for(;;)switch(this.s){
case 16:this.mk(17,'namespace');continue
case 17:if(this.namePath(_={category:'Namespace'},0)){name=_.name; $.source.namespace ??= { kind: 'namespace', name: name }; }continue
default:
this.attachLocation( $.source.namespace )
return this.exit_()
}
}
usingDeclaration($,$next){
let decl={ kind: 'using' }
this.rule_(19,$next)
for(;;)switch(this.s){
case 19:this.mk(20,'using');continue
case 20:switch(this.lk()){
case'from':this.ck(21);continue
case'Id':this.usingProxy({outer:$.source,proxy:decl},22);continue
case'{':this.s=24;{ $.source.usings.push( decl ); }continue
default:this.ei();continue
}
case 21:if(this.m(0,'String')){ $.source.dependencies.push( this.quotedLiteral() ); }continue
case 22:switch(this.lk()){
case'from':this.ck(23);continue
default:this.gr([';']);continue
}
case 23:if(this.m(0,'String')){ $.source.dependencies.push( decl.fileDep = this.quotedLiteral() ); }continue
case 24:if(this.m(25,'{')){ decl.usings = this.createArray(); }continue
case 25:switch(this.lk()){
case'Id':this.s=26;continue
default:this.ei();continue
}
case 26:switch(this.l()){
case'Id':this.usingProxy({outer:decl,proxy:{ kind: 'using' }},27);continue
default:this.s=28;continue
}
case 27:switch(this.l()){
case',':this.c(26);continue
case'}':this.s=28;continue
default:this.e();continue
}
case 28:if(this.m(29,'}')){this.afterBrace(); this.finalizeDictOrArray( decl.usings ); }continue
case 29:switch(this.lk()){
case'from':this.ck(30);continue
default:this.gr([';']);continue
}
case 30:if(this.m(0,'String')){ $.source.dependencies.push( decl.fileDep = this.quotedLiteral() ); }continue
default:
this.attachLocation( decl )
return this.exit_()
}
}
usingProxy($,$next){
let extern;let _
this.rule_(32,$next)
for(;;)switch(this.s){
case 32:if(this.simplePath(_={category:'global'},33)){extern=_.ref; $.proxy.extern = extern; $.outer.usings.push( $.proxy ); }continue
case 33:switch(this.lk()){
case'as':this.ck(34);continue
default:if(this.gr([])){ this.classifyImplicitName( 'Using' ); }continue
}
case 34:if(this.mi(0,'UsingAlias')){ $.proxy.name = this.identAst(); }continue
default:
this.attachLocation( $.proxy )
return this.exit_()
}
}
namePath($,$next){
$.name??=new XsnName()
this.rule_(36,$next)
for(;;)switch(this.s){
case 36:if(this.mi(37,$.category)){ $.name.path = [ this.identAst() ]; }continue
case 37:switch(this.l()){
case'.':this.c(38);continue
default:this.gr(['@']);continue
}
case 38:if(this.miA(37,$.category)){ $.name.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.name )
return this.exit_()
}
}
simplePath($,$next){
$.ref??={}
this.rule_(40,$next)
for(;;)switch(this.s){
case 40:if(this.mi(41,$.category)){ $.ref.path = [ this.identAst() ]; }continue
case 41:switch(this.l()){
case'.':this.c(42);continue
default:this.gr([]);continue
}
case 42:if(this.miA(41,$.category)){ $.ref.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.ref )
return this.exit_()
}
}
serviceDef($,$next){
let name;let _
this.rule_(44,$next)
for(;;)switch(this.s){
case 44:this.mk(45,'service');continue
case 45:if(this.namePath(_={category:'Service'},46)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'service', name );
this.docComment( $.art ); }continue
case 46:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},46);continue
default:this.s=47;continue
}
case 47:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
contextDef($,$next){
let name;let _
this.rule_(49,$next)
for(;;)switch(this.s){
case 49:this.mk(50,'context');continue
case 50:if(this.namePath(_={category:'Context'},51)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'context', name );
this.docComment( $.art ); }continue
case 51:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},51);continue
default:this.s=52;continue
}
case 52:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
annotationDef($,$next){
let name;let _
this.rule_(54,$next)
for(;;)switch(this.s){
case 54:this.mk(55,'annotation');continue
case 55:if(this.namePath(_={category:'AnnoDef'},56)){name=_.name; this.addDef( $.art, $.outer, ($.outer.kind === 'source' ? 'vocabularies' : 'artifacts'), 'annotation', name );
this.docComment( $.art ); }continue
case 56:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},56);continue
default:this.s=57;continue
}
case 57:this.typeOrIncludesSpec({art:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
typeDef($,$next){
let name;let _
this.rule_(59,$next)
for(;;)switch(this.s){
case 59:this.mk(60,'type');continue
case 60:if(this.namePath(_={category:'Type'},61)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'type', name );
this.docComment( $.art ); }continue
case 61:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},61);continue
default:this.s=62;continue
}
case 62:this.typeOrIncludesSpec({art:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
aspectDef($,$next){
let name;let incl;let _
this.rule_(64,$next)
for(;;)switch(this.s){
case 64:switch(this.lk()){
case'aspect':this.ck(66);continue
case'abstract':if(this.ck(65)){ this.warning( 'syntax-deprecated-abstract', this.lb().location ); }continue
default:this.e();continue
}
case 65:this.mk(66,'entity');continue
case 66:if(this.namePath(_={category:'Type'},67)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'aspect', name );
this.docComment( $.art ); }continue
case 67:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},67);continue
default:this.s=68;continue
}
case 68:switch(this.l()){
case'{':this.elementsBlock({art:$.art},72);continue
case':':this.c(69);continue
default:this.gr([';']);continue
}
case 69:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},70)){incl=_.ref; $.art.includes ??= []; $.art.includes.push( incl ); }continue
default:this.s=71;continue
}
case 70:switch(this.l()){
case',':this.c(69);continue
case'{':this.s=71;continue
default:this.gr([';']);continue
}
case 71:this.elementsBlock({art:$.art},72);continue
case 72:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
entityDef($,$next){
let name;let incl;let query;let _
this.rule_(74,$next)
for(;;)switch(this.s){
case 74:this.mk(75,'entity');continue
case 75:if(this.namePath(_={category:'Entity'},76)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'entity', name );
this.docComment( $.art ); }continue
case 76:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},76);continue
default:this.s=77;continue
}
case 77:switch(this.l()){
case'(':this.paramsList({art:$.art},78);continue
default:this.s=78;continue
}
case 78:switch(this.lk()){
case':':if(this.c(79)){ $.art.includes ??= []; }continue
case'{':this.s=82;continue
case'as':this.ck(83);continue
default:this.e();continue
}
case 79:switch(this.lk()){
case'Id':this.s=80;continue
default:this.ei();continue
}
case 80:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},81)){incl=_.ref; $.art.includes.push( incl ); }continue
default:this.s=82;continue
}
case 81:switch(this.l()){
case',':this.c(80);continue
case'{':this.s=82;continue
default:this.e();continue
}
case 82:this.elementsBlock({art:$.art},86);continue
case 83:switch(this.lk()){
case'(':case'select':if(this.queryExpression(_={},86)){query=_.expr; $.art.query = query; $.art.$syntax = 'entity'; }continue
case'projection':if(this.projectionSpec(_={},84)){query=_.query; $.art.query = query; $.art.$syntax = 'projection'; }continue
default:this.e();continue
}
case 84:switch(this.lk()){
case'group':case'where':case'having':this.whereGroupByHaving({query},85);continue
default:this.s=85;continue
}
case 85:switch(this.lk()){
case'limit':case'order':this.orderByLimitOffset({query},86);continue
default:this.s=86;continue
}
case 86:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
viewDef($,$next){
let name;let query;let _
this.rule_(88,$next)
for(;;)switch(this.s){
case 88:this.mk(89,'view');continue
case 89:if(this.namePath(_={category:'Entity'},90)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'entity', name );
this.docComment( $.art ); }continue
case 90:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},90);continue
default:this.s=91;continue
}
case 91:switch(this.lk()){
case'(':this.paramsList({art:$.art},97);continue
case'with':this.ck(92);continue
default:this.s=97;continue
}
case 92:if(this.mk(93,'parameters')){ $.art.params = this.createDict(); }continue
case 93:this.paramDef({outer:$.art},94);continue
case 94:switch(this.l()){
case',':this.c(95);continue
default:this.s=96;continue
}
case 95:this.paramDef({outer:$.art},94);continue
case 96:this.s=97;{ this.finalizeDictOrArray( $.art.params ); }continue
case 97:this.mk(98,'as');continue
case 98:if(this.queryExpression(_={},0)){query=_.expr; $.art.query = query; $.art.$syntax = 'view'; }continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
eventDef($,$next){
let name;let incl;let query;let _
this.rule_(100,$next)
for(;;)switch(this.s){
case 100:this.mk(101,'event');continue
case 101:if(this.namePath(_={category:'Event'},102)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'event', name );
this.docComment( $.art ); }continue
case 102:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},102);continue
default:this.s=103;continue
}
case 103:switch(this.l()){
case'{':this.elementsBlock({art:$.art},0);continue
case':':this.c(104);continue
default:this.e();continue
}
case 104:switch(this.lk()){
case'{':this.elementsBlock({art:$.art},0);continue
case'Id':if(this.simplePath(_={category:'artref'},105)){incl=_.ref; $.art.type = incl; }continue
case'projection':if(this.lP()&&this.projectionSpec(_={},0)){query=_.query; $.art.query = query; $.art.$syntax = 'projection'; }continue
default:this.ei();continue
}
case 105:switch(this.l()){
case',':case'{':this.s=106;{ $.art.includes = [ $.art.type ]; delete $.art.type; }continue
default:this.s=110;{ this.docComment( $.art ); }continue
}
case 106:switch(this.l()){
case',':this.c(107);continue
default:this.s=109;continue
}
case 107:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},108)){incl=_.ref; $.art.includes.push( incl ); }continue
default:this.s=109;continue
}
case 108:switch(this.l()){
case',':this.c(107);continue
case'{':this.s=109;continue
default:this.e();continue
}
case 109:this.elementsBlock({art:$.art},0);continue
case 110:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},110);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
actionMainDef($,$next){
let name;let _
this.rule_(112,$next)
for(;;)switch(this.s){
case 112:this.mk(113,'action');continue
case 113:if(this.namePath(_={category:'Action'},114)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'action', name );
this.docComment( $.art ); }continue
case 114:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},114);continue
default:this.s=115;continue
}
case 115:this.paramsList({art:$.art},116);continue
case 116:switch(this.lk()){
case'returns':this.returnsSpec({outer:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
functionMainDef($,$next){
let name;let _
this.rule_(118,$next)
for(;;)switch(this.s){
case 118:this.mk(119,'function');continue
case 119:if(this.namePath(_={category:'Action'},120)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'function', name );
this.docComment( $.art ); }continue
case 120:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},120);continue
default:this.s=121;continue
}
case 121:this.paramsList({art:$.art},122);continue
case 122:this.returnsSpec({outer:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
actionsBlock($,$next){
this.rule_(124,$next)
for(;;)switch(this.s){
case 124:if(this.mk(125,'actions')){ $.art.actions = this.createDict(); }continue
case 125:this.m(126,'{');continue
case 126:switch(this.l()){
case'Id':case'@':this.boundActionFunctionDef({outer:$.art},127);continue
default:this.s=128;continue
}
case 127:switch(this.l()){
case';':this.c(126);continue
case'}':this.s=128;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(126)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 128:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.actions ); }continue
default:return this.exit_()
}
}
boundActionFunctionDef($,$next){
let art=new XsnArtifact()
this.rule_(130,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 130:switch(this.l()){
case'@':this.annoAssignStd({art},130);continue
default:this.s=131;continue
}
case 131:switch(this.lk()){
case'action':this.ck(132);continue
case'function':this.ck(136);continue
default:this.e();continue
}
case 132:if(this.mi(133,'BoundAction')){ this.addDef( art, $.outer, 'actions', 'action', this.identAst() );
this.docComment( art ); }continue
case 133:switch(this.l()){
case'@':this.annoAssignMid({art},133);continue
default:this.s=134;continue
}
case 134:this.paramsList({art},135);continue
case 135:switch(this.lk()){
case'returns':this.returnsSpec({outer:art},0);continue
default:this.gr([';','@','}','action','function']);continue
}
case 136:if(this.mi(137,'BoundAction')){ this.addDef( art, $.outer, 'actions', 'function', this.identAst() );
this.docComment( art ); }continue
case 137:switch(this.l()){
case'@':this.annoAssignMid({art},137);continue
default:this.s=138;continue
}
case 138:this.paramsList({art},139);continue
case 139:this.returnsSpec({outer:art},0);continue
default:
this.attachLocation( art )
return this.exit_()
}
}
paramsList($,$next){
this.rule_(141,$next)
for(;;)switch(this.s){
case 141:if(this.m(142,'(')){ $.art.params = this.createDict(); }continue
case 142:switch(this.l()){
case'Id':case'@':this.paramDef({outer:$.art},143);continue
default:this.s=144;continue
}
case 143:switch(this.l()){
case',':this.c(142);continue
case')':this.s=144;continue
default:this.e();continue
}
case 144:if(this.m(0,')')){ this.finalizeDictOrArray( $.art.params ); }continue
default:return this.exit_()
}
}
paramDef($,$next){
let art=new XsnArtifact()
this.rule_(146,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 146:switch(this.l()){
case'@':this.annoAssignStd({art},146);continue
default:this.s=147;continue
}
case 147:if(this.miA(148,'Param')){ this.addDef( art, $.outer, 'params', 'param', this.identAst() );
this.docComment( art ); }continue
case 148:switch(this.l()){
case'@':this.annoAssignMid({art},148);continue
default:this.s=149;continue
}
case 149:switch(this.l()){
case'{':this.elementsBlock({art},150);continue
case':':this.c(151);continue
default:this.e();continue
}
case 150:switch(this.lk()){
case'not':case'null':this.nullability({art},0);continue
default:this.gr([',']);continue
}
case 151:this.typeExpression({art},0);continue
default:
this.attachLocation( art )
return this.exit_()
}
}
returnsSpec($,$next){
let art=new XsnArtifact()
let ret
this.rule_(153,$next)
for(;;)switch(this.s){
case 153:if(this.mk(154,'returns')){ret=this.lb();this.elementRestriction(0,'default'); art.kind = 'param'; $.outer.returns = art;
this.docComment( art ); }continue
case 154:switch(this.l()){
case'@':this.annoAssignStd({art},154);continue
default:this.s=155;continue
}
case 155:this.typeExpression({art},0);continue
default:
this.attachLocation( art ); if (ret) art.location.tokenIndex = ret.location.tokenIndex
return this.exit_()
}
}
elementsBlock($,$next){
this.rule_(157,$next)
for(;;)switch(this.s){
case 157:if(this.m(158,'{')){ $.art.elements = this.createDict(); }continue
case 158:switch(this.l()){
case'Id':case'@':this.elementDef({outer:$.art,art:undefined},159);continue
default:this.s=160;continue
}
case 159:switch(this.l()){
case';':this.c(158);continue
case'}':this.s=160;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(158)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 160:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.elements ); }continue
default:return this.exit_()
}
}
elementDef($,$next){
let expr;let _
this.rule_(162,$next)
{ $.art ??= new XsnArtifact();
this.docComment( $.art ); }
for(;;)switch(this.s){
case 162:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},162);continue
default:this.s=163;continue
}
case 163:switch(this.lk()){
case'virtual':if(this.ckP(164,['Id','key'])){ $.art.virtual = this.valueWithLocation( true ); }continue
default:this.s=164;continue
}
case 164:switch(this.lk()){
case'key':if(this.ck(165)){ $.art.key = this.valueWithLocation( true ); }continue
default:this.s=165;continue
}
case 165:switch(this.lk()){
case'masked':if(this.ckP(166,['Id'])){ $.art.masked = this.valueWithLocation( true );
this.message( 'syntax-unsupported-masked', this.lb(), { keyword: 'masked' } ); }continue
default:this.s=166;continue
}
case 166:switch(this.lk()){
case'element':if(this.ckP(167,['Id'])){ $.art.$syntax = 'element'; }continue
default:this.s=167;continue
}
case 167:if(this.mi(168,'Element')){this.elementRestriction(0,'elem'); this.addDef( $.art, $.outer, 'elements', 'element', this.identAst() );
this.docComment( $.art ); }continue
case 168:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},168);continue
default:this.s=169;continue
}
case 169:switch(this.l()){
case'{':this.elementsBlock({art:$.art},170);continue
case':':this.c(171);continue
default:this.s=172;continue
}
case 170:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},172);continue
default:this.s=172;continue
}
case 171:this.typeExpression({art:$.art},172);continue
case 172:switch(this.l()){
case'=':this.gc(0,'elementRestriction','calc')&&this.c(173);continue
default:this.gr(['Id',';','@','}','key']);continue
}
case 173:if(this.expression(_={},174)){expr=_.expr; $.art.value = expr; }continue
case 174:switch(this.lk()){
case'stored':if(this.ck(175)){ $.art.value.stored = this.valueWithLocation( true ); }continue
default:this.s=175;continue
}
case 175:this.s=176;{ if (this.elementRestriction( true, 'anno' )) this.docComment( $.art ); }continue
case 176:switch(this.l()){
case'@':this.gc(0,'elementRestriction','anno')&&this.annoAssignStd({art:$.art},176);continue
default:this.gr(['Id',';','@','}','key']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
enumSymbolsBlock($,$next){
this.rule_(178,$next)
for(;;)switch(this.s){
case 178:if(this.mk(179,'enum')){ $.art.enum = this.createDict(); }continue
case 179:this.m(180,'{');continue
case 180:switch(this.l()){
case'Id':case'@':this.enumSymbolDef({outer:$.art},181);continue
default:this.s=182;continue
}
case 181:switch(this.l()){
case';':this.c(180);continue
case'}':this.s=182;continue
default:this.e();continue
}
case 182:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.enum ); }continue
default:return this.exit_()
}
}
enumSymbolDef($,$next){
let art=new XsnArtifact()
let sign;let value;let _
this.rule_(184,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 184:switch(this.l()){
case'@':this.annoAssignStd({art},184);continue
default:this.s=185;continue
}
case 185:if(this.mi(186,'Enum')){ this.addDef( art, $.outer, 'enum', 'enum', this.identAst() );
this.docComment( art ); }continue
case 186:switch(this.l()){
case'@':this.annoAssignStd({art},186);continue
default:this.s=187;continue
}
case 187:switch(this.l()){
case'=':this.c(188);continue
default:this.gr([';','}']);continue
}
case 188:switch(this.l()){
case'String':if(this.c(190)){ art.value = this.quotedLiteral(); }continue
case'Number':if(this.c(190)){ art.value = this.numberLiteral(); }continue
case'+':case'-':if(this.c(189))sign=this.lb();continue
case'Id':case'#':case'QuotedLiteral':if(this.literalValue(_={},190)){value=_.expr; art.value = value; }continue
default:this.e();continue
}
case 189:if(this.m(190,'Number')){ art.value = this.numberLiteral( sign ); }continue
case 190:this.s=191;{ this.docComment( art ); }continue
case 191:switch(this.l()){
case'@':this.annoAssignStd({art},191);continue
default:this.gr([';','}']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
foreignKeysBlock($,$next){
this.rule_(193,$next)
for(;;)switch(this.s){
case 193:if(this.m(194,'{')){ $.art.foreignKeys = this.createDict(); }continue
case 194:switch(this.l()){
case'Id':case'@':this.foreignKeyDef({outer:$.art},195);continue
default:this.s=196;continue
}
case 195:switch(this.l()){
case',':this.c(194);continue
case'}':this.s=196;continue
default:this.e();continue
}
case 196:if(this.m(0,'}')){ this.finalizeDictOrArray( $.art.foreignKeys ); }continue
default:return this.exit_()
}
}
foreignKeyDef($,$next){
let art=new XsnArtifact();let name
let ref;let _
this.rule_(198,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 198:switch(this.l()){
case'@':this.annoAssignStd({art},198);continue
default:this.s=199;continue
}
case 199:if(this.simplePath(_={category:'ref'},200)){ref=_.ref; art.targetElement = ref; }continue
case 200:switch(this.lk()){
case'as':this.ck(201);continue
default:if(this.gr([',','}'])){ this.classifyImplicitName( 'KeyImplicit', ref ); name = ref.path; }continue
}
case 201:if(this.mi(0,'Key')){name=this.lb(); name = this.identAst(); }continue
case 0:{ this.addDef( art, $.outer, 'foreignKeys', 'key', name ); }
default:
this.attachLocation(art)
return this.exit_()
}
}
mixinElementDef($,$next){
let art=new XsnArtifact()
let assoc;let card;let target;let expr;let _
this.rule_(203,$next)
for(;;)switch(this.s){
case 203:if(this.mi(204,'Mixin')){ this.addDef( art, $.outer, 'mixin', 'mixin', this.identAst() ); }continue
case 204:this.m(205,':');continue
case 205:switch(this.lk()){
case'association':if(this.ck(206))assoc=this.lb();continue
case'composition':if(this.ck(208))assoc=this.lb();continue
default:this.e();continue
}
case 206:switch(this.l()){
case'[':this.cardinality({art},207);continue
default:this.s=207;continue
}
case 207:this.mk(210,'to');continue
case 208:switch(this.l()){
case'[':this.cardinality({art},209);continue
default:this.s=209;continue
}
case 209:this.mk(210,'of');continue
case 210:switch(this.lk()){
case'one':case'many':if(this.ckP(211,['Id']))card=this.lb();continue
default:this.s=211;continue
}
case 211:if(this.simplePath(_={category:'artref'},212)){target=_.ref; this.setAssocAndComposition( art, assoc, card, target ); }continue
case 212:this.mk(213,'on');continue
case 213:if(this.condition(_={},0)){expr=_.expr; art.on = expr; }continue
default:
this.attachLocation(art)
return this.exit_()
}
}
annotateArtifact($,$next){
let name;let elemName;let keyword;let _
this.rule_(215,$next)
for(;;)switch(this.s){
case 215:if(this.namePath(_={category:'Ext'},216))name=_.name;continue
case 216:switch(this.lk()){
case':':this.c(217);continue
case'with':if(this.ck(222))keyword=this.lb();continue
default:this.s=222;continue
}
case 217:if(this.namePath(_={category:'ExtElement'},218)){elemName=_.name; this.addExtension( $.art, $.outer, 'annotate', name, elemName.path ); }continue
case 218:switch(this.lk()){
case'with':if(this.ck(219))keyword=this.lb();continue
default:this.s=219;continue
}
case 219:this.s=220;{ this.docComment( $.art ); }continue
case 220:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},220);continue
default:this.s=221;continue
}
case 221:switch(this.l()){
case'{':this.annotateElementsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 222:this.s=223;{ this.addExtension( $.art, $.outer, 'annotate', name );
this.docComment( $.art ); }continue
case 223:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},223);continue
default:this.s=224;continue
}
case 224:switch(this.l()){
case'(':this.annotateParamsBlock({art:$.art},225);continue
default:this.s=225;continue
}
case 225:switch(this.lk()){
case'returns':this.annotateReturns({outer:$.art},0);continue
case'{':this.annotateElementsBlock({art:$.art},226);continue
default:this.s=226;continue
}
case 226:switch(this.lk()){
case'actions':this.annotateActionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendArtifact($,$next){
let name;let elemName;let keyword;let elements;let incl;let _
this.rule_(228,$next)
for(;;)switch(this.s){
case 228:if(this.namePath(_={category:'Ext'},229))name=_.name;continue
case 229:switch(this.lk()){
case':':this.c(230);continue
case'with':if(this.ck(239)){keyword=this.lb(); this.addExtension( $.art, $.outer, 'extend', name );
this.docComment( $.art ); }continue
default:this.s=236;{ this.addExtension( $.art, $.outer, 'extend', name );
this.docComment( $.art ); }continue
}
case 230:if(this.namePath(_={category:'ExtElement'},231)){elemName=_.name; this.addExtension( $.art, $.outer, 'extend', name, elemName.path ); }continue
case 231:switch(this.lk()){
case'with':if(this.ck(232))keyword=this.lb();continue
default:this.s=232;continue
}
case 232:this.s=233;{ this.docComment( $.art ); }continue
case 233:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},233);continue
default:this.s=234;continue
}
case 234:switch(this.lk()){
case'elements':if(this.ck(235))elements=this.lb();continue
case'{':this.s=235;continue
case'enum':this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
default:this.gr([';']);continue
}
case 235:this.extendElementsBlock({art:$.art,start:elements},0);continue
case 236:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},236);continue
default:this.s=237;continue
}
case 237:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},238);continue
default:this.gr([';']);continue
}
case 238:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 239:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},239);continue
default:this.s=240;continue
}
case 240:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},241)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'elements':if(this.ckP(245,['{']))elements=this.lb();continue
case'{':this.s=245;continue
case'actions':this.lP()&&this.actionsBlock({art:$.art},0);continue
case'enum':this.lP()&&this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
case'columns':this.ckP(247,['{']);continue
case'definitions':this.ckP(248,['{']);continue
default:this.gi(0,[';']);continue
}
case 241:switch(this.l()){
case',':this.c(242);continue
default:this.s=243;continue
}
case 242:if(this.simplePath(_={category:'artref'},241)){incl=_.ref; $.art.includes.push( incl ); }continue
case 243:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},244);continue
default:this.s=244;continue
}
case 244:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 245:this.extendElementsBlock({art:$.art,start:elements},246);continue
case 246:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 247:this.selectItemsList({query:$.art,start:this.lb()},0);continue
case 248:this.artifactsBlock({art:$.art,start:this.lb()},0);continue
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendService($,$next){
let name;let keyword;let _
this.rule_(250,$next)
for(;;)switch(this.s){
case 250:if(this.mk(251,'service')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 251:if(this.namePath(_={category:'ExtService'},252)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 252:switch(this.lk()){
case'with':if(this.ck(253))keyword=this.lb();continue
default:this.s=253;continue
}
case 253:this.s=254;{ this.docComment( $.art ); }continue
case 254:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},254);continue
default:this.s=255;continue
}
case 255:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendContext($,$next){
let name;let keyword;let _
this.rule_(257,$next)
for(;;)switch(this.s){
case 257:if(this.mk(258,'context')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 258:if(this.namePath(_={category:'ExtContext'},259)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 259:switch(this.lk()){
case'with':if(this.ck(260))keyword=this.lb();continue
default:this.s=260;continue
}
case 260:this.s=261;{ this.docComment( $.art ); }continue
case 261:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},261);continue
default:this.s=262;continue
}
case 262:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendType($,$next){
let name;let keyword;let incl;let elements;let _
this.rule_(264,$next)
for(;;)switch(this.s){
case 264:if(this.mk(265,'type')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 265:if(this.namePath(_={category:'Ext'},266)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 266:switch(this.lk()){
case'with':if(this.ck(269)){keyword=this.lb(); this.docComment( $.art ); }continue
default:this.s=267;{ this.docComment( $.art ); }continue
}
case 267:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},267);continue
default:this.s=268;continue
}
case 268:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
case 269:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},269);continue
default:this.s=270;continue
}
case 270:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},271)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'elements':if(this.ckP(274,['{']))elements=this.lb();continue
case'{':this.s=274;continue
case'enum':this.lP()&&this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
default:this.gi(0,[';']);continue
}
case 271:switch(this.l()){
case',':this.c(272);continue
default:this.s=273;continue
}
case 272:if(this.simplePath(_={category:'artref'},271)){incl=_.ref; $.art.includes.push( incl ); }continue
case 273:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
case 274:this.extendElementsBlock({art:$.art,start:elements},0);continue
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendEntityOrAspect($,$next){
let name;let keyword;let incl;let _
this.rule_(276,$next)
for(;;)switch(this.s){
case 276:switch(this.lk()){
case'aspect':case'entity':if(this.ck(277)){ $.art.expectedKind = this.valueWithLocation(); }continue
default:this.e();continue
}
case 277:if(this.namePath(_={category:'Ext'},278)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 278:switch(this.lk()){
case'with':if(this.ck(280)){keyword=this.lb(); this.docComment( $.art ); }continue
default:this.s=279;{ this.docComment( $.art ); }continue
}
case 279:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},279);continue
default:this.s=284;continue
}
case 280:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},280);continue
default:this.s=281;continue
}
case 281:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},282)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'actions':this.gP(284);continue
default:this.gi(284);continue
}
case 282:switch(this.l()){
case',':this.c(283);continue
default:this.s=284;continue
}
case 283:if(this.simplePath(_={category:'artref'},282)){incl=_.ref; $.art.includes.push( incl ); }continue
case 284:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},285);continue
default:this.s=285;continue
}
case 285:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendProjection($,$next){
let name;let keyword;let _
this.rule_(287,$next)
for(;;)switch(this.s){
case 287:if(this.mk(288,'projection')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 288:if(this.namePath(_={category:'Ext'},289)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 289:switch(this.lk()){
case'with':if(this.ck(290))keyword=this.lb();continue
default:this.s=290;continue
}
case 290:this.s=291;{ this.docComment( $.art ); }continue
case 291:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},291);continue
default:this.s=292;continue
}
case 292:switch(this.l()){
case'{':this.selectItemsList({query:$.art,start:undefined},293);continue
default:this.s=293;continue
}
case 293:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
annotateActionsBlock($,$next){
this.rule_(295,$next)
for(;;)switch(this.s){
case 295:if(this.mk(296,'actions')){ $.art.actions = this.createDict(); }continue
case 296:this.m(297,'{');continue
case 297:switch(this.l()){
case'Id':case'@':this.annotateBoundAction({outer:$.art},298);continue
default:this.s=299;continue
}
case 298:switch(this.l()){
case';':this.c(297);continue
case'}':this.s=299;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(297)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 299:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.actions ); }continue
default:return this.exit_()
}
}
annotateBoundAction($,$next){
let art=new XsnArtifact()
this.rule_(301,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 301:switch(this.l()){
case'@':this.annoAssignStd({art},301);continue
default:this.s=302;continue
}
case 302:if(this.mi(303,'ExtBoundAction')){ this.addDef( art, $.outer, 'actions', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 303:switch(this.l()){
case'@':this.annoAssignStd({art},303);continue
default:this.s=304;continue
}
case 304:switch(this.l()){
case'(':this.annotateParamsBlock({art},305);continue
default:this.s=305;continue
}
case 305:switch(this.lk()){
case'returns':this.lP()&&this.annotateReturns({outer:art},0);continue
default:this.gr(['Id',';','@','}']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
annotateParamsBlock($,$next){
this.rule_(307,$next)
for(;;)switch(this.s){
case 307:if(this.m(308,'(')){ $.art.params = this.createDict(); }continue
case 308:switch(this.l()){
case'Id':case'@':this.annotateParam({outer:$.art},309);continue
default:this.s=310;continue
}
case 309:switch(this.l()){
case',':this.c(308);continue
case')':this.s=310;continue
default:this.e();continue
}
case 310:if(this.m(0,')')){ this.finalizeExtensionsDict( $.art.params ); }continue
default:return this.exit_()
}
}
annotateParam($,$next){
let art=new XsnArtifact()
this.rule_(312,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 312:switch(this.l()){
case'@':this.annoAssignStd({art},312);continue
default:this.s=313;continue
}
case 313:if(this.mi(314,'ExtParam')){ this.addDef( art, $.outer, 'params', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 314:switch(this.l()){
case'@':this.annoAssignStd({art},314);continue
default:this.gr([')',',']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
annotateReturns($,$next){
let art=new XsnArtifact()
let ret
this.rule_(316,$next)
for(;;)switch(this.s){
case 316:if(this.mk(317,'returns')){ret=this.lb(); $.outer.returns = art; art.kind = 'annotate';
this.docComment( art ); }continue
case 317:switch(this.l()){
case'@':this.annoAssignStd({art},317);continue
default:this.s=318;continue
}
case 318:switch(this.l()){
case'{':this.annotateElementsBlock({art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( art ); if (ret) art.location.tokenIndex = ret.location.tokenIndex
return this.exit_()
}
}
annotateElementsBlock($,$next){
this.rule_(320,$next)
for(;;)switch(this.s){
case 320:if(this.m(321,'{')){ $.art.elements = this.createDict(); }continue
case 321:switch(this.l()){
case'Id':case'@':this.annotateElement({outer:$.art},322);continue
default:this.s=323;continue
}
case 322:switch(this.l()){
case';':this.c(321);continue
case'}':this.s=323;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(321)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 323:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.elements ); }continue
default:return this.exit_()
}
}
annotateElement($,$next){
let art=new XsnArtifact()
this.rule_(325,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 325:switch(this.l()){
case'@':this.annoAssignStd({art},325);continue
default:this.s=326;continue
}
case 326:if(this.mi(327,'ExtElement')){ this.addDef( art, $.outer, 'elements', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 327:switch(this.l()){
case'@':this.annoAssignStd({art},327);continue
default:this.s=328;continue
}
case 328:switch(this.l()){
case'{':this.annotateElementsBlock({art},0);continue
default:this.gr(['Id',';','@','}']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
extendElementsBlock($,$next){
this.rule_(330,$next)
for(;;)switch(this.s){
case 330:if(this.m(331,'{')){ $.art.elements = this.createDict( $.start ); }continue
case 331:switch(this.l()){
case'Id':case'@':this.elementDefOrExtend({outer:$.art},332);continue
default:this.s=333;continue
}
case 332:switch(this.l()){
case';':this.c(331);continue
case'}':this.s=333;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(331)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 333:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.elements ); }continue
default:return this.exit_()
}
}
elementDefOrExtend($,$next){
let art=new XsnArtifact()
let keyword;let elements
this.rule_(335,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 335:switch(this.l()){
case'@':this.annoAssignStd({art},335);continue
default:this.s=336;continue
}
case 336:switch(this.lk()){
case'Id':case'@':case'key':this.elementDef({outer:$.outer,art},0);continue
case'extend':this.ckP(337,['Id']);continue
default:this.ei();continue
}
case 337:switch(this.lk()){
case'element':if(this.ckP(338,['Id'])){ art.expectedKind = this.valueWithLocation(); }continue
default:this.s=338;continue
}
case 338:if(this.mi(339,'ExtElement')){ this.addDef( art, $.outer, 'elements', 'extend', this.identAst() ); }continue
case 339:switch(this.lk()){
case'with':if(this.ck(342)){keyword=this.lb(); this.docComment( art ); }continue
default:this.s=340;{ this.docComment( art ); }continue
}
case 340:switch(this.l()){
case'@':this.annoAssignStd({art},340);continue
default:this.s=341;continue
}
case 341:switch(this.l()){
case'{':this.extendElementsBlock({art,start:undefined},0);continue
default:this.gr(['Id',';','@','}','key']);continue
}
case 342:switch(this.l()){
case'@':this.annoAssignStd({art},342);continue
default:this.s=343;continue
}
case 343:switch(this.lk()){
case'elements':if(this.ck(344))elements=this.lb();continue
case'{':this.s=344;continue
case'enum':this.enumSymbolsBlock({art},0);continue
case'(':this.typeNamedArgsList({art},0);continue
default:this.gr(['Id',';','@','}','key']);continue
}
case 344:this.extendElementsBlock({art,start:elements},0);continue
default:
this.checkWith( keyword ); this.attachLocation( art )
return this.exit_()
}
}
typeOrIncludesSpec($,$next){
let ref;let _
this.rule_(346,$next)
for(;;)switch(this.s){
case 346:switch(this.l()){
case'{':this.elementsBlock({art:$.art},347);continue
case':':this.c(348);continue
default:this.e();continue
}
case 347:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([';']);continue
}
case 348:switch(this.lk()){
case'{':case'many':case'type':case'array':case'localized':case'association':case'composition':this.lP()&&this.typeExpression({art:$.art},0);continue
case'Id':if(this.simplePath(_={category:'artref'},349)){ref=_.ref; $.art.type = ref; }continue
default:this.ei();continue
}
case 349:switch(this.lk()){
case'(':case':':this.typeRefOptArgs({art:$.art},350,405);continue
case'@':case'not':case'enum':case'null':case'default':this.typeExpression({art:$.art},0,358);continue
case',':case'{':this.s=351;{ $.art.includes = [ $.art.type ]; delete $.art.type; }continue
default:if(this.gr([';'])){ this.docComment( $.art ); }continue
}
case 350:switch(this.lk()){
case'@':case'not':case'enum':case'null':case'default':this.typeExpression({art:$.art},0,358);continue
default:if(this.gr([';'])){ this.docComment( $.art ); }continue
}
case 351:switch(this.l()){
case',':this.c(352);continue
default:this.s=354;continue
}
case 352:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},353)){ref=_.ref; $.art.includes.push( ref ); }continue
default:this.s=354;continue
}
case 353:switch(this.l()){
case',':this.c(352);continue
case'{':this.s=354;continue
default:this.e();continue
}
case 354:this.elementsBlock({art:$.art},355);continue
case 355:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([';']);continue
}
default:return this.exit_()
}
}
typeExpression($,$next,$startState){
let expr;let assoc;let card;let _
this.rule_($startState??357,$next)
for(;;)switch(this.s){
case 357:switch(this.lk()){
case'Id':this.typeRefOptArgs({art:$.art},358);continue
case'type':this.lP()&&this.typeTypeOf({art:$.art},358);continue
case'localized':if(this.ckP(367,['Id'])){ $.art.localized = this.valueWithLocation( true ); }continue
case'association':if(this.ckP(369,['[','to'])){assoc=this.lb();this.elementRestriction(0,'calc')}continue;
case'composition':if(this.ckP(373,['[','of'])){assoc=this.lb();this.elementRestriction(0,'calc')}continue;
case'array':if(this.ckP(377,['of'])){this.elementRestriction(0,'calc')}continue;
case'many':if(this.ckP(378,['Id','{'])){this.elementRestriction(0,'calc'); $.art.items = { location: this.lb().location }; }continue
case'{':if(this.elementsBlock({art:$.art},384)){this.elementRestriction(0,'calc')}continue;
default:this.ei();continue
}
case 358:this.s=359;{ this.docComment( $.art ); }continue
case 359:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},359);continue
default:this.s=360;continue
}
case 360:switch(this.lk()){
case'not':case'null':if(this.gc(362,'elementRestriction','notNull')&&this.nullability({art:$.art},361)){ this.docComment( $.art ); }continue
default:this.s=362;continue
}
case 361:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},361);continue
default:this.s=362;continue
}
case 362:switch(this.lk()){
case'enum':if(this.enumSymbolsBlock({art:$.art},363)){this.elementRestriction(0,'anno')}continue;
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 363:switch(this.lk()){
case'not':case'null':this.gc(364,'elementRestriction','notNull')&&this.nullability({art:$.art},364);continue
default:this.s=364;continue
}
case 364:switch(this.lk()){
case'default':this.gc(366,'elementRestriction','default')&&this.ck(365);continue
default:this.s=366;continue
}
case 365:if(this.expression(_={},366)){expr=_.expr; $.art.default = expr; }continue
case 366:switch(this.lk()){
case'not':case'null':this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art},0);continue
default:this.gr([]);continue
}
case 367:if(this.typeRefOptArgs({art:$.art},368)){ this.docComment( $.art ); }continue
case 368:switch(this.lk()){
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 369:switch(this.l()){
case'[':this.cardinality({art:$.art},370);continue
default:this.s=370;continue
}
case 370:this.mk(371,'to');continue
case 371:switch(this.lk()){
case'one':case'many':if(this.ckP(372,['Id']))card=this.lb();continue
default:this.s=372;continue
}
case 372:this.typeAssocProperties({art:$.art,assoc,card},0);continue
case 373:switch(this.l()){
case'[':this.cardinality({art:$.art},374);continue
default:this.s=374;continue
}
case 374:this.mk(375,'of');continue
case 375:switch(this.lk()){
case'one':case'many':if(this.ckP(376,['Id','{']))card=this.lb();continue
default:this.s=376;continue
}
case 376:switch(this.l()){
case'Id':this.typeAssocProperties({art:$.art,assoc,card},0);continue
case'{':if(this.elementsBlock({art:this.setAssocAndComposition( $.art, assoc, card )},0)){ $.art.target.location = $.art.target.elements[Symbol.for('cds.$location')]; }continue
default:this.e();continue
}
case 377:if(this.mk(378,'of')){ $.art.items = { location: this.locationOfPrevTokens( 2 ) }; }continue
case 378:switch(this.lk()){
case'Id':this.typeRefOptArgs({art:$.art.items},379);continue
case'type':this.lP()&&this.typeTypeOf({art:$.art.items},379);continue
case'{':this.elementsBlock({art:$.art.items},383);continue
default:this.ei();continue
}
case 379:switch(this.lk()){
case'not':case'null':this.gc(380,'elementRestriction','notNull')&&this.nullability({art:$.art.items},380);continue
default:this.s=380;continue
}
case 380:switch(this.lk()){
case'enum':this.enumSymbolsBlock({art:$.art.items},383);continue
default:this.s=381;{ this.docComment( $.art ); }continue
}
case 381:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},381);continue
default:this.s=382;continue
}
case 382:if(this.gr([])){ ; }continue
case 383:switch(this.lk()){
case'not':case'null':this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art.items},0);continue
default:this.gr([]);continue
}
case 384:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([]);continue
}
default:return this.exit_()
}
}
typeAssocProperties($,$next){
let target;let cond;let _
this.rule_(386,$next)
for(;;)switch(this.s){
case 386:if(this.simplePath(_={category:'artref'},387)){target=_.ref; this.setAssocAndComposition( $.art, $.assoc, $.card, target );
this.docComment( $.art ); }continue
case 387:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},387);continue
default:this.s=388;continue
}
case 388:switch(this.lk()){
case'on':this.ck(389);continue
case'{':if(this.foreignKeysBlock({art:$.art},391)){ this.docComment( $.art ); }continue
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 389:if(this.condition(_={},390)){cond=_.expr; $.art.on = cond;
this.docComment( $.art ); }continue
case 390:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},390);continue
default:this.gr([]);continue
}
case 391:switch(this.lk()){
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
default:return this.exit_()
}
}
typeProperties($,$next){
let expr;let _
this.rule_(393,$next)
for(;;)switch(this.s){
case 393:switch(this.lk()){
case'@':this.annoAssignStd({art:$.art},393);continue
case'not':case'null':if(this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art},393)){ this.docComment( $.art ); }continue
case'default':this.gc(0,'elementRestriction','default')&&this.ck(394);continue
default:this.gr([]);continue
}
case 394:if(this.expression(_={},393)){expr=_.expr; $.art.default = expr; this.docComment( $.art ); }continue
default:return this.exit_()
}
}
typeTypeOf($,$next){
let location
let type;let _
this.rule_(396,$next)
for(;;)switch(this.s){
case 396:this.mk(397,'type');continue
case 397:if(this.mk(398,'of')){ location = this.locationOfPrevTokens( 2 ); }continue
case 398:if(this.simplePath(_={category:'ref'},399)){type=_.ref; $.art.type = type; }continue
case 399:switch(this.l()){
case':':if(this.c(400)){ type.scope = type.path.length; }continue
default:if(this.gr(['@'])){ type.scope = 'typeOf'; type.path.unshift( { id: 'type of', location } ); }continue
}
case 400:if(this.miA(401,'ref')){ type.path.push( this.identAst() ); }continue
case 401:switch(this.l()){
case'.':this.c(402);continue
default:this.gr(['@']);continue
}
case 402:if(this.miA(401,'ref')){ type.path.push( this.identAst() ); }continue
default:return this.exit_()
}
}
typeRefOptArgs($,$next,$startState){
let type=$.art.type
let open;let tok;let _
this.rule_($startState??404,$next)
for(;;)switch(this.s){
case 404:if(this.simplePath(_={category:'artref'},405)){type=_.ref; $.art.type = type; }continue
case 405:switch(this.l()){
case':':if(this.c(406)){ type.scope = type.path.length; }continue
case'(':if(this.c(409))open=this.lb();continue
default:this.gr([]);continue
}
case 406:if(this.miA(407,'ref')){ type.path.push( this.identAst() ); }continue
case 407:switch(this.l()){
case'.':this.c(408);continue
default:this.gr([]);continue
}
case 408:if(this.miA(407,'ref')){ type.path.push( this.identAst() ); }continue
case 409:switch(this.lk()){
case'Number':if(this.c(410)){ $.art.$typeArgs = this.createArray( open );
$.art.$typeArgs.push( this.unsignedIntegerLiteral() ); }continue
case'Id':this.s=413;{ $.art.$typeArgs = this.createDict( open ); }continue
default:this.ei();continue
}
case 410:switch(this.l()){
case',':this.c(411);continue
default:this.s=412;continue
}
case 411:switch(this.lk()){
case'Number':if(this.c(410)){ $.art.$typeArgs.push( this.unsignedIntegerLiteral() ); }continue
case'floating':case'variable':if(this.ck(410)){tok=this.lb(); $.art.$typeArgs.push( { literal: 'string', val: tok.keyword, location: tok.location } ); }continue
case')':this.s=412;continue
default:this.e();continue
}
case 412:this.s=415;{ this.checkTypeArgs( $.art ); }continue
case 413:switch(this.l()){
case'Id':this.typeNamedArg({art:$.art},414);continue
default:this.s=415;continue
}
case 414:switch(this.l()){
case',':this.c(413);continue
case')':this.s=415;continue
default:this.e();continue
}
case 415:if(this.m(0,')')){ if ($.art.$typeArgs) this.finalizeDictOrArray( $.art.$typeArgs ); }continue
default:return this.exit_()
}
}
typeNamedArgsList($,$next){
this.rule_(417,$next)
for(;;)switch(this.s){
case 417:if(this.m(418,'(')){ $.art.$typeArgs = this.createDict(); }continue
case 418:switch(this.l()){
case'Id':this.typeNamedArg({art:$.art},419);continue
default:this.s=420;continue
}
case 419:switch(this.l()){
case',':this.c(418);continue
case')':this.s=420;continue
default:this.e();continue
}
case 420:if(this.m(0,')')){ this.finalizeDictOrArray( $.art.$typeArgs ); }continue
default:return this.exit_()
}
}
typeNamedArg($,$next){
let name;let tok
this.rule_(422,$next)
for(;;)switch(this.s){
case 422:if(this.mi(423,'typeparamname'))name=this.lb();continue
case 423:this.m(424,':');continue
case 424:switch(this.lk()){
case'Number':if(this.c(0)){ this.setTypeFacet( $.art, name, this.unsignedIntegerLiteral() ); }continue
case'floating':case'variable':if(this.ck(0)){tok=this.lb(); this.setTypeFacet( $.art, name, { literal: 'string', val: tok.keyword, location: tok.location } ); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
cardinality($,$next){
let card={}
this.rule_(426,$next)
for(;;)switch(this.s){
case 426:this.m(427,'[');continue
case 427:switch(this.l()){
case'*':if(this.c(428)){ card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(430)){ card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.s=432;{ card.targetMax = this.valueWithLocation( '*' ); }continue
}
case 428:switch(this.l()){
case',':this.c(429);continue
default:this.s=432;continue
}
case 429:this.targetCardinality({card,atAlt:false},432);continue
case 430:switch(this.l()){
case',':this.c(431);continue
case'..':this.targetCardinality({card,atAlt:true},432,435);continue
default:this.s=432;continue
}
case 431:this.targetCardinality({card,atAlt:false},432);continue
case 432:this.m(0,']');continue
default:
$.art.cardinality = this.attachLocation(card)
return this.exit_()
}
}
targetCardinality($,$next,$startState){
this.rule_($startState??434,$next)
{ if (!$.atAlt) $.card.sourceMax = $.card.targetMax; }
for(;;)switch(this.s){
case 434:switch(this.l()){
case'*':if(this.c(0)){ $.card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(435)){ $.card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.e();continue
}
case 435:switch(this.l()){
case'..':if(this.c(436)){ $.card.targetMin = $.card.targetMax; }continue
default:this.gr([']']);continue
}
case 436:switch(this.l()){
case'*':if(this.c(0)){ $.card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(0)){ $.card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
nullability($,$next){
this.rule_(438,$next)
for(;;)switch(this.s){
case 438:switch(this.lk()){
case'null':if(this.ck(0)){ this.setNullability( $.art, false ); }continue
case'not':this.ck(439);continue
default:this.e();continue
}
case 439:if(this.mk(0,'null')){ this.setNullability( $.art, true, this.locationOfPrevTokens( 2 ) ); }continue
default:return this.exit_()
}
}
queryEOF($,$next){
$.query??=undefined
let _
this.rule_(441,$next)
for(;;)switch(this.s){
case 441:if(this.queryExpression(_={},442))$.query=_.expr;continue
case 442:switch(this.l()){
case';':this.c(443);continue
default:this.s=443;continue
}
case 443:this.m(0,'EOF');continue
default:return this.exit_()
}
}
projectionSpec($,$next){
$.query??={}
let tab;let _
this.rule_(445,$next)
for(;;)switch(this.s){
case 445:if(this.mk(446,'projection')){ $.query = { op: this.valueWithLocation( 'SELECT' ) }; }continue
case 446:this.mk(447,'on');continue
case 447:if(this.fromRefWithOptAlias(_={},448)){tab=_.expr; this.afterBrace();
$.query.from = tab; }continue
case 448:switch(this.l()){
case'{':this.selectItemsList({query:$.query,start:undefined},449);continue
default:this.s=449;continue
}
case 449:switch(this.lk()){
case'excluding':this.excludingClause({query:$.query},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation($.query)
return this.exit_()
}
}
queryExpression($,$next,$startState){
$.expr??={}
let op;let quantifier
let query;let _
this.rule_($startState??451,$next)
for(;;)switch(this.s){
case 451:switch(this.l()){
case'(':this.c(452);continue
case'Id':if(this.selectQuery(_={},454))$.expr=_.query;continue
default:this.e();continue
}
case 452:this.queryExpression($,453);continue
case 453:if(this.m(454,')')){ this.surroundByParens( $.expr ); }continue
case 454:switch(this.lk()){
case'intersect':if(this.gc(458,'precLeft_',4)&&this.ck(455)){ op = this.valueWithLocation(); }continue
case'minus':case'except':if(this.gc(458,'precLeft_',2)&&this.ck(455)){ op = this.valueWithLocation(); }continue
case'union':if(this.gc(458,'precLeft_',2)&&this.ck(456)){ op = this.valueWithLocation(); }continue
default:this.s=458;continue
}
case 455:switch(this.lk()){
case'distinct':if(this.ck(457)){ quantifier = this.valueWithLocation(); }continue
default:this.s=457;continue
}
case 456:switch(this.lk()){
case'all':case'distinct':if(this.ck(457)){ quantifier = this.valueWithLocation(); }continue
default:this.s=457;continue
}
case 457:if(this.queryExpression(_={},454)){query=_.expr; if ($.expr.$parens || op.val !== $.expr.op.val || quantifier?.val !== $.expr.quantifier?.val) $.expr = { op, args: [$.expr], quantifier };
quantifier = undefined;
$.expr.args.push( query ); this.attachLocation( $.expr ); }continue
case 458:switch(this.lk()){
case'limit':case'order':if(this.gc(0,'precPost_',0)&&this.g(459)){ if ($.expr.$parens) { this.attachLocation( $.expr ); $.expr = { op: this.valueWithLocation( '$query', this.la() ), args: [ $.expr ] }; } }continue
default:this.gr([]);continue
}
case 459:this.orderByLimitOffset({query:$.expr},0);continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
selectQuery($,$next){
$.query??={}
this.rule_(461,$next)
for(;;)switch(this.s){
case 461:if(this.mk(462,'select')){ $.query = { op: this.valueWithLocation( 'SELECT' ) }; }continue
case 462:switch(this.lk()){
case'from':this.ck(463);continue
case'all':case'distinct':if(this.ckP(473,['Id','#','(','*','+','-',':','?','@','{','key','not','case','cast','null','true','false','Number','String','exists','QuotedLiteral'])){ $.query.quantifier = this.valueWithLocation(); }continue
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'@':case'{':case'key':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=473;continue
default:this.ei();continue
}
case 463:this.querySource({query:$.query},464);continue
case 464:switch(this.lk()){
case'mixin':this.ck(465);continue
default:this.s=470;continue
}
case 465:if(this.m(466,'{')){ $.query.mixin = this.createDict(); }continue
case 466:switch(this.l()){
case'Id':this.mixinElementDef({outer:$.query},467);continue
default:this.s=468;continue
}
case 467:switch(this.l()){
case';':this.c(466);continue
case'}':this.s=468;continue
default:this.e();continue
}
case 468:if(this.m(469,'}')){ this.finalizeDictOrArray( $.query.mixin ); }continue
case 469:this.mk(470,'into');continue
case 470:switch(this.lk()){
case'all':case'distinct':if(this.ck(471)){ $.query.quantifier = this.valueWithLocation(); }continue
default:this.s=471;continue
}
case 471:switch(this.l()){
case'{':this.selectItemsList({query:$.query,start:undefined},472);continue
default:this.s=472;continue
}
case 472:switch(this.lk()){
case'excluding':this.excludingClause({query:$.query},478);continue
default:this.s=478;continue
}
case 473:switch(this.l()){
case'*':if(this.c(474)){ $.query.columns = [ this.valueWithLocation() ]; }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:($.query.columns = [])},474);continue
default:this.e();continue
}
case 474:switch(this.l()){
case',':this.c(475);continue
default:this.s=476;continue
}
case 475:switch(this.l()){
case'*':if(this.c(474)){ $.query.columns.push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query.columns},474);continue
default:this.e();continue
}
case 476:this.mk(477,'from');continue
case 477:this.querySource({query:$.query},478);continue
case 478:switch(this.lk()){
case'group':case'where':case'having':this.whereGroupByHaving({query:$.query},0);continue
default:this.gr(['limit','minus','order','union','except','intersect']);continue
}
default:
this.attachLocation($.query)
return this.exit_()
}
}
querySource($,$next){
let tab;let _
this.rule_(480,$next)
for(;;)switch(this.s){
case 480:if(this.tableExpression(_={},481)){tab=_.expr; $.query.from = tab; }continue
case 481:switch(this.l()){
case',':this.s=482;{ const { location } = this.la();
$.query.from = { op: { val: 'join', location }, join: { val: 'cross', location }, args: [tab] }; }continue
default:this.gr(['group','limit','minus','order','union','where','except','having','intersect']);continue
}
case 482:switch(this.l()){
case',':this.c(483);continue
default:this.gr(['group','limit','minus','order','union','where','except','having','intersect']);continue
}
case 483:if(this.tableExpression(_={},482)){tab=_.expr; $.query.from.args.push( tab ); }continue
case 0:
this.attachLocation($.query.from)
default:return this.exit_()
}
}
tableExpression($,$next,$startState){
$.expr??={}
let join;let tab;let card;let cond;let _
this.rule_($startState??485,$next)
for(;;)switch(this.s){
case 485:switch(this.l()){
case'(':this.tableOrQueryParens($,486);continue
case'Id':this.fromRefWithOptAlias($,487);continue
default:this.e();continue
}
case 486:this.s=487;{ $.expr = this.taggedIfQuery( $.expr ); }continue
case 487:switch(this.lk()){
case'cross':if(this.ck(488))join=this.lb();continue
case'inner':if(this.ck(491))join=this.lb();continue
case'full':case'left':case'right':if(this.ck(490))join=this.lb();continue
case'join':if(this.ck(493)){ join = undefined; }continue
default:this.gr([]);continue
}
case 488:if(this.mk(489,'join')){ if ($.expr?.join?.val !== 'cross' || $.expr.$parens) $.expr = { op: this.valueWithLocation(), join: this.valueWithLocation( undefined, join ), args: [ $.expr ] }; }continue
case 489:switch(this.l()){
case'(':if(this.tableOrQueryParens(_={},487)){tab=_.expr; $.expr.args.push( this.taggedIfQuery( tab ) );
this.attachLocation( $.expr ); }continue
case'Id':if(this.fromRefWithOptAlias(_={},487)){tab=_.expr; $.expr.args.push( tab );
this.attachLocation( $.expr ); }continue
default:this.e();continue
}
case 490:switch(this.lk()){
case'outer':this.ck(491);continue
default:this.s=491;continue
}
case 491:switch(this.lk()){
case'one':case'many':case'exact':this.joinCardinality(card={},492);continue
default:this.s=492;continue
}
case 492:this.mk(493,'join');continue
case 493:this.s=494;{ $.expr = { op: this.valueWithLocation(), join: this.valueWithLocation( join?.keyword || 'inner', join ), args: [ $.expr ] }; if (card) $.expr.cardinality = card; card = undefined; }continue
case 494:if(this.tableExpression(_={},495)){tab=_.expr; $.expr.args.push( tab ); this.attachLocation( $.expr ); }continue
case 495:this.mk(496,'on');continue
case 496:if(this.condition(_={},487)){cond=_.expr; $.expr.on = cond;
this.attachLocation( $.expr ); }continue
default:return this.exit_()
}
}
tableOrQueryParens($,$next){
$.expr??=undefined
this.rule_(498,$next)
for(;;)switch(this.s){
case 498:if(this.m(499,'(')){this.queryOnLeft()}continue;
case 499:switch(this.lk()){
case'(':this.tableOrQueryParens($,500);continue
case'Id':if(this.tableExpression($,501)){this.queryOnLeft(0,'table')}continue;
case'select':this.queryExpression($,501);continue
default:this.ei();continue
}
case 500:switch(this.lk()){
case'full':case'join':case'left':case'cross':case'inner':case'right':if(this.tableExpression($,501,486)){this.queryOnLeft(0,'table')}continue;
case'limit':case'minus':case'order':case'union':case'except':case'intersect':this.gc(501,'queryOnLeft')&&this.queryExpression($,501,454);continue
default:this.s=501;continue
}
case 501:if(this.m(502,')')){ this.surroundByParens( $.expr ); }continue
case 502:switch(this.lk()){
case'as':this.gc(0,'queryOnLeft','table')&&this.ck(503);continue
case'Id':if(this.gc(0,'queryOnLeft','tableWithoutAs')&&this.ci(0,'FromAlias')){ $.expr = this.taggedIfQuery( $.expr ); $.expr.name = this.fragileAlias(); }continue
default:this.gi(0,['full','join','left','cross','inner','right']);continue
}
case 503:if(this.mi(0,'FromAlias')){ $.expr = this.taggedIfQuery( $.expr ); $.expr.name = this.identAst(); }continue
default:return this.exit_()
}
}
joinCardinality($,$next){
$.sourceMax??=undefined;$.targetMax??=undefined
this.rule_(505,$next)
for(;;)switch(this.s){
case 505:switch(this.lk()){
case'exact':if(this.ck(506)){ $.sourceMin = this.valueWithLocation( 1 ); }continue
case'one':this.s=506;continue
case'many':if(this.ck(507)){ $.sourceMax = this.valueWithLocation( '*' ); }continue
default:this.e();continue
}
case 506:if(this.mk(507,'one')){ $.sourceMax = this.valueWithLocation( 1 ); }continue
case 507:this.mk(508,'to');continue
case 508:switch(this.lk()){
case'exact':if(this.ck(509)){ $.targetMin = this.valueWithLocation( 1 ); }continue
case'one':this.s=509;continue
case'many':if(this.ck(0)){ $.targetMax = this.valueWithLocation( '*' ); }continue
default:this.e();continue
}
case 509:if(this.mk(0,'one')){ $.targetMax = this.valueWithLocation( 1 ); }continue
default:
this.attachLocation( $ )
return this.exit_()
}
}
fromRefWithOptAlias($,$next){
$.expr??={}
this.rule_(511,$next)
{ $.expr.path = []; }
for(;;)switch(this.s){
case 511:this.fromPath({table:$.expr,category:'artref'},512);continue
case 512:switch(this.l()){
case':':if(this.c(513)){ if (!$.expr.scope) $.expr.scope = $.expr.path.length; else {
this.warning( 'syntax-invalid-path-separator', this.lb(),
{ '#': 'colon', code: ':', newcode: '.' } );
} }continue
default:this.s=514;continue
}
case 513:this.fromPath({table:$.expr,category:'ref'},514);continue
case 514:switch(this.lk()){
case'as':this.ck(515);continue
case'Id':if(this.gc(516,'tableWithoutAs')&&this.ci(0,'FromAlias')){ $.expr.name = this.fragileAlias(); }continue
default:this.giR(516);continue
}
case 515:if(this.mi(0,'FromAlias')){ $.expr.name = this.identAst(); }continue
case 516:if(this.gr([])){ this.classifyImplicitName( $.expr.scope ? 'FromElemImplicit' : 'FromImplicit', $.expr ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
fromPath($,$next){
let pathItem
this.rule_(518,$next)
for(;;)switch(this.s){
case 518:if(this.mi(519,$.category)){ $.table.path.push( pathItem = this.identAst() ); }continue
case 519:switch(this.l()){
case'(':case'[':if(this.fromArgumentsAndFilter({pathStep:pathItem},520)){ pathItem = null; }continue
default:this.s=520;continue
}
case 520:switch(this.l()){
case'.':if(this.c(521)){ if (!pathItem && !$.table.scope) {
$.table.scope = $.table.path.length; $.category = 'ref';
this.warning( 'syntax-invalid-path-separator', this.lb(),
{ '#': 'dot', code: '.', newcode: ':' } );
} }continue
default:this.gr(['Id','as']);continue
}
case 521:if(this.miA(522,$.category)){ $.table.path.push( pathItem = this.identAst() ); }continue
case 522:switch(this.l()){
case'(':case'[':if(this.fromArgumentsAndFilter({pathStep:pathItem},520)){ pathItem = null; }continue
default:this.s=520;continue
}
default:
this.attachLocation( $.table.path )
return this.exit_()
}
}
fromArgumentsAndFilter($,$next){
this.rule_(524,$next)
for(;;)switch(this.s){
case 524:switch(this.l()){
case'(':if(this.c(525)){ $.pathStep.args = this.createDict(); $.pathStep.$syntax = ':'; }continue
default:this.s=529;continue
}
case 525:switch(this.lk()){
case'Id':this.s=526;continue
default:this.ei();continue
}
case 526:switch(this.l()){
case'Id':this.fromNamedArgument($,527);continue
default:this.s=528;continue
}
case 527:switch(this.l()){
case',':this.c(526);continue
case')':this.s=528;continue
default:this.e();continue
}
case 528:this.m(529,')');continue
case 529:switch(this.l()){
case'[':this.cardinalityAndFilter($,0);continue
default:this.gr(['Id','.','as']);continue
}
default:return this.exit_()
}
}
fromNamedArgument($,$next){
let name;let expr;let _
this.rule_(531,$next)
for(;;)switch(this.s){
case 531:if(this.mi(532,'paramname'))name=this.lb();continue
case 532:this.m(533,':');continue
case 533:if(this.expression(_={},0)){expr=_.expr; this.addDef( expr, $.pathStep, 'args', 0, this.identAst( name ) ); }continue
default:return this.exit_()
}
}
cardinalityAndFilter($,$next){
this.rule_(535,$next)
for(;;)switch(this.s){
case 535:this.m(536,'[');continue
case 536:switch(this.l()){
case'Number':if(this.gc(538,'beforeColon')&&this.c(537)){ $.pathStep.cardinality = { targetMax: this.unsignedIntegerLiteral(), location: this.lb().location }; }continue
default:this.s=538;continue
}
case 537:this.m(538,':');continue
case 538:this.filterClauses({pathStep:$.pathStep},539);continue
case 539:this.m(0,']');continue
default:return this.exit_()
}
}
filterClauses($,$next){
let cond;let _
this.rule_(541,$next)
for(;;)switch(this.s){
case 541:switch(this.lk()){
case'where':this.ck(542);continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=542;continue
case'group':case'limit':case'order':case'having':this.gP(543);continue
default:this.gi(543);continue
}
case 542:if(this.condition(_={},543)){cond=_.expr; $.pathStep.where = cond; }continue
case 543:switch(this.lk()){
case'group':this.s=544;{ this.csnParseOnly('syntax-unexpected-sql-clause', 1, { keyword: 'group by' }); }continue
default:this.s=545;continue
}
case 544:this.groupByClause({query:$.pathStep},545);continue
case 545:switch(this.lk()){
case'having':if(this.ck(546)){ this.csnParseOnly('syntax-unexpected-sql-clause', -1, { keyword: 'having' }); }continue
default:this.s=547;continue
}
case 546:if(this.condition(_={},547)){cond=_.expr; $.pathStep.having = cond; }continue
case 547:switch(this.lk()){
case'limit':case'order':this.s=548;{ if (this.lk() === 'limit') this.csnParseOnly('syntax-unexpected-sql-clause', 0, { keyword: 'limit' } ); else this.csnParseOnly('syntax-unexpected-sql-clause', 1, { keyword: 'order by' } ); }continue
default:this.gr([']']);continue
}
case 548:this.orderByLimitOffset({query:$.pathStep},0);continue
default:return this.exit_()
}
}
excludingClause($,$next){
this.rule_(550,$next)
for(;;)switch(this.s){
case 550:this.mk(551,'excluding');continue
case 551:if(this.m(552,'{')){ $.query.excludingDict = this.createDict(); }continue
case 552:switch(this.l()){
case'Id':this.s=553;continue
default:this.e();continue
}
case 553:switch(this.l()){
case'Id':if(this.ciA(554,'ref')){ this.addDef( { location: this.lb().location }, $.query, 'excludingDict', '', this.identAst() ); }continue
default:this.s=555;continue
}
case 554:switch(this.l()){
case',':this.c(553);continue
case'}':this.s=555;continue
default:this.e();continue
}
case 555:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query.excludingDict ); }continue
default:return this.exit_()
}
}
selectItemsList($,$next){
this.rule_(557,$next)
for(;;)switch(this.s){
case 557:if(this.m(558,'{')){this.inSelectItem(0,'top'); $.query.columns = this.createArray( $.start ); }continue
case 558:switch(this.l()){
case'*':if(this.c(559)){ $.query.columns.push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query.columns},559);continue
default:this.s=560;continue
}
case 559:switch(this.l()){
case',':this.c(558);continue
case'}':this.s=560;continue
default:this.e();continue
}
case 560:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query.columns ); }continue
default:return this.exit_()
}
}
nestedSelectItemsList($,$next){
this.rule_(562,$next)
for(;;)switch(this.s){
case 562:if(this.m(563,'{')){this.inSelectItem(0,'nested'); $.query[$.clause] = this.createArray(); }continue
case 563:switch(this.l()){
case'*':if(this.c(564)){ $.query[$.clause].push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query[$.clause]},564);continue
default:this.s=565;continue
}
case 564:switch(this.l()){
case',':this.c(563);continue
case'}':this.s=565;continue
default:this.e();continue
}
case 565:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query[$.clause] ); }continue
default:return this.exit_()
}
}
selectItemDef($,$next){
let art=new XsnArtifact();let alias
let expr;let as;let target;let cond;let assoc;let card;let _
this.rule_(567,$next)
{ $.columns.push( art );
this.docComment( art ); }
for(;;)switch(this.s){
case 567:switch(this.l()){
case'@':this.annoAssignCol({art},567);continue
default:this.s=568;continue
}
case 568:switch(this.lk()){
case'virtual':if(this.lP(['Id','#','(','+','-',':','?','{','key','not','case','cast','null','true','false','Number','String','exists','QuotedLiteral'])&&this.gc(569,'modifierRestriction')&&this.ck(569)){ art.virtual = this.valueWithLocation( true ); }continue
default:this.s=569;continue
}
case 569:switch(this.lk()){
case'key':if(this.gc(570,'modifierRestriction')&&this.ck(570)){ art.key = this.valueWithLocation( true ); }continue
default:this.s=570;continue
}
case 570:switch(this.l()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'Number':case'String':case'QuotedLiteral':if(this.expression(_={},571)){expr=_.expr; art.value = expr; }continue
case'{':this.nestedSelectItemsList({query:art,clause:'expand'},578);continue
default:this.e();continue
}
case 571:switch(this.lk()){
case'as':if(this.ck(572))as=this.lb();continue
case'Id':if(this.ci(573,'ItemAlias')){ art.name = this.fragileAlias( true ); }continue
default:if(this.gi(573)){ alias = this.classifyImplicitName( 'ItemImplicit', expr ); }continue
}
case 572:if(this.mi(573,'ItemAlias')){ art.name = this.identAst(); }continue
case 573:switch(this.l()){
case'{':this.s=574;{ this.reportExpandInline( art, false ); }continue
case'.':if(this.c(576)){ this.reportUnexpectedSpace( this.lb(), this.la().location, true );
this.reportExpandInline( art, as || true );
if (alias) alias.token.parsedAs = alias.parsedAs; }continue
default:this.s=581;continue
}
case 574:this.nestedSelectItemsList({query:art,clause:'expand'},575);continue
case 575:switch(this.lk()){
case'excluding':this.excludingClause({query:art},581);continue
default:this.s=581;continue
}
case 576:switch(this.l()){
case'{':this.nestedSelectItemsList({query:art,clause:'inline'},577);continue
case'*':if(this.c(581)){ art.inline = [ this.valueWithLocation() ]; }continue
default:this.e();continue
}
case 577:switch(this.lk()){
case'excluding':this.excludingClause({query:art},581);continue
default:this.s=581;continue
}
case 578:switch(this.lk()){
case'excluding':this.excludingClause({query:art},579);continue
default:this.s=579;continue
}
case 579:this.mk(580,'as');continue
case 580:if(this.mi(581,'ItemAlias')){ art.name = this.identAst(); }continue
case 581:this.s=582;{ this.docComment( art ); }continue
case 582:switch(this.l()){
case'@':this.annoAssignMid({art},582);continue
default:this.s=583;continue
}
case 583:switch(this.l()){
case':':this.c(584);continue
default:this.gr([',']);continue
}
case 584:switch(this.lk()){
case'type':this.lP()&&this.typeTypeOf({art},598);continue
case'localized':if(this.ckP(585,['Id'])){ art.localized = this.valueWithLocation( true ); }continue
case'Id':this.s=585;continue
case'redirected':this.ckP(586,['to']);continue
case'association':if(this.ckP(590,['[','to'])){assoc=this.lb(); this.associationInSelectItem( art ); }continue
case'composition':if(this.ckP(592,['[','of'])){assoc=this.lb(); this.associationInSelectItem( art ); }continue
default:this.ei();continue
}
case 585:this.typeRefOptArgs({art},598);continue
case 586:this.mk(587,'to');continue
case 587:if(this.simplePath(_={category:'artref'},588)){target=_.ref; art.target = target; }continue
case 588:switch(this.lk()){
case'on':this.ck(589);continue
case'{':this.foreignKeysBlock({art},598);continue
default:this.s=598;continue
}
case 589:if(this.condition(_={},598)){cond=_.expr; art.on = cond; }continue
case 590:switch(this.l()){
case'[':this.cardinality({art},591);continue
default:this.s=591;continue
}
case 591:this.mk(594,'to');continue
case 592:switch(this.l()){
case'[':this.cardinality({art},593);continue
default:this.s=593;continue
}
case 593:this.mk(594,'of');continue
case 594:switch(this.lk()){
case'one':case'many':if(this.ckP(595,['Id']))card=this.lb();continue
default:this.s=595;continue
}
case 595:if(this.simplePath(_={category:'artref'},596)){target=_.ref; this.setAssocAndComposition( art, assoc, card, target ); }continue
case 596:this.mk(597,'on');continue
case 597:if(this.condition(_={},598)){expr=_.expr; art.on = expr; }continue
case 598:this.s=599;{ this.docComment( art ); }continue
case 599:switch(this.l()){
case'@':this.annoAssignStd({art},599);continue
default:this.gr([',']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
whereGroupByHaving($,$next){
let cond;let _
this.rule_(601,$next)
for(;;)switch(this.s){
case 601:switch(this.lk()){
case'where':this.ck(602);continue
default:this.s=603;continue
}
case 602:if(this.condition(_={},603)){cond=_.expr; $.query.where = cond; }continue
case 603:switch(this.lk()){
case'group':this.groupByClause($,604);continue
default:this.s=604;continue
}
case 604:switch(this.lk()){
case'having':this.ck(605);continue
default:this.gr(['limit','order']);continue
}
case 605:if(this.condition(_={},0)){cond=_.expr; $.query.having = cond; }continue
default:return this.exit_()
}
}
groupByClause($,$next){
let expr;let _
this.rule_(607,$next)
for(;;)switch(this.s){
case 607:this.mk(608,'group');continue
case 608:this.mk(609,'by');continue
case 609:if(this.expression(_={},610)){expr=_.expr; $.query.groupBy = [ expr ]; }continue
case 610:switch(this.l()){
case',':this.c(611);continue
default:this.gr(['limit','order','having']);continue
}
case 611:if(this.expression(_={},610)){expr=_.expr; $.query.groupBy.push( expr ); }continue
default:return this.exit_()
}
}
orderByLimitOffset($,$next){
let expr;let _
this.rule_(613,$next)
for(;;)switch(this.s){
case 613:switch(this.lk()){
case'order':this.orderByClause($,614);continue
default:this.s=614;continue
}
case 614:switch(this.lk()){
case'limit':this.ck(615);continue
default:this.gr([]);continue
}
case 615:if(this.expression(_={},616)){expr=_.expr; $.query.limit = { rows: expr }; }continue
case 616:switch(this.lk()){
case'offset':this.ck(617);continue
default:this.gr([]);continue
}
case 617:if(this.expression(_={},0)){expr=_.expr; $.query.limit.offset = expr; }continue
default:return this.exit_()
}
}
orderByClause($,$next){
let expr;let _
this.rule_(619,$next)
for(;;)switch(this.s){
case 619:this.mk(620,'order');continue
case 620:this.mk(621,'by');continue
case 621:if(this.orderByExpression(_={},622)){expr=_.expr; $.query.orderBy = [ expr ]; }continue
case 622:switch(this.l()){
case',':this.c(623);continue
default:this.gr(['limit']);continue
}
case 623:if(this.orderByExpression(_={},622)){expr=_.expr; $.query.orderBy.push( expr ); }continue
default:return this.exit_()
}
}
orderByExpression($,$next){
$.expr??=undefined
this.rule_(625,$next)
for(;;)switch(this.s){
case 625:this.expression($,626);continue
case 626:switch(this.lk()){
case'asc':case'desc':if(this.ck(627)){ $.expr.sort = this.valueWithLocation(); }continue
default:this.s=627;continue
}
case 627:switch(this.lk()){
case'nulls':this.ck(628);continue
default:this.gr([',','limit']);continue
}
case 628:switch(this.lk()){
case'last':case'first':if(this.ck(0)){ $.expr.nulls = this.valueWithLocation(); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
conditionEOF($,$next){
$.cond??=undefined
let _
this.rule_(630,$next)
for(;;)switch(this.s){
case 630:if(this.expression(_={},631))$.cond=_.expr;continue
case 631:this.m(0,'EOF');continue
default:return this.exit_()
}
}
condition($,$next){
$.expr??=undefined
this.rule_(633,$next)
for(;;)switch(this.s){
case 633:this.expression($,0);continue
default:return this.exit_()
}
}
valuePath($,$next,$startState){
$.expr??={ path: [] }
let pathItem
this.rule_($startState??635,$next)
for(;;)switch(this.s){
case 635:if(this.mi(636,'ref')){ $.expr.path.push( pathItem = this.identAst() ); }continue
case 636:switch(this.l()){
case'(':case'[':this.argumentsAndFilter({pathStep:pathItem},637);continue
default:this.s=637;continue
}
case 637:switch(this.l()){
case'.':this.gc(0,'isDotForPath')&&this.c(638);continue
default:this.gr(['*','+','-','/','<','=','>','?','!=','<=','<>','>=','in','is','or','||','and','not','like','between']);continue
}
case 638:if(this.miA(639,'ref')){ $.expr.path.push( pathItem = this.identAst() ); }continue
case 639:switch(this.l()){
case'(':case'[':if(this.argumentsAndFilter({pathStep:pathItem},637)){ pathItem = null; }continue
default:this.s=637;continue
}
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
expression($,$next,$startState){
$.expr??={}
let e;let open;let _
this.rule_($startState??641,$next)
for(;;)switch(this.s){
case 641:switch(this.lk()){
case'(':this.expressionOrQueryParens($,642);continue
case'#':case'null':case'true':case'false':case'Number':case'String':case'QuotedLiteral':this.literalValue($,652);continue
case':':if(this.c(643)){ this.reportUnexpectedSpace(); }continue
case'?':if(this.c(652)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'dynamic', code: '?' } );
$.expr = this.attachLocation({ param: this.valueWithLocation(), scope: 'param' }); }continue
case'Id':if(this.valuePath(_={},645)){e=_.expr; $.expr = this.valuePathAst( e ); }continue
case'new':this.lP()&&this.newAndValuePath($,652);continue
case'exists':if(this.ck(648)){ $.expr = this.applyOpToken(); }continue
case'case':this.caseExpression($,652);continue
case'cast':this.castFunction($,652);continue
case'+':case'-':if(this.ec('precRight_',30)&&this.c(651)){ $.expr = this.applyOpToken(); }continue
case'not':if(this.ec('precRight_',8)&&this.ck(651)){ $.expr = this.applyOpToken(); }continue
default:this.ei();continue
}
case 642:this.s=652;{ $.expr = this.taggedIfQuery( $.expr ); }continue
case 643:switch(this.l()){
case'Id':if(this.ciA(644,'paramref')){ $.expr = { path: [ this.identAst() ], location: this.startLocation(), scope: 'param' }; }continue
case'Number':if(this.c(652)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'positional', code: ':' + this.lb().text } );
$.expr = this.attachLocation({ param: this.unsignedIntegerLiteral(), scope: 'param' }); }continue
default:this.e();continue
}
case 644:switch(this.l()){
case'.':if(this.valuePath($,652,637)){ $.expr = this.valuePathAst( $.expr ); }continue
default:this.s=652;{ this.attachLocation( $.expr ); }continue
}
case 645:switch(this.lk()){
case'over':if(this.ck(646)){ this.pushXprToken( $.expr.suffix = [] ); }continue
default:this.s=647;continue
}
case 646:this.overClause(e={outer:$.expr.suffix},647);continue
case 647:this.s=652;{ this.attachLocation( $.expr ); }continue
case 648:switch(this.l()){
case'(':if(this.c(649))open=this.lb();continue
case'Id':if(this.valuePath(_={},652)){e=_.expr; e = this.valuePathAst( e ); e.$expected = 'exists';
$.expr.args.push( e ); this.attachLocation( $.expr ); }continue
case'?':if(this.c(652)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'dynamic', code: '?' } );
$.expr.args.push( { param: this.valueWithLocation(), scope: 'param' } ); this.attachLocation( $.expr ); }continue
default:this.e();continue
}
case 649:if(this.queryExpression(_={},650))e=_.expr;continue
case 650:if(this.m(652,')')){ $.expr.args.push( this.taggedIfQuery( this.surroundByParens( e, open ) ) );
this.attachLocation( $.expr ); }continue
case 651:if(this.expression(_={},652)){e=_.expr; $.expr = this.signedExpression( $.expr, e ); }continue
case 652:switch(this.lk()){
case'*':case'/':if(this.gc(0,'precLeft_',24)&&this.c(656)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'+':case'-':if(this.gc(0,'precLeft_',22)&&this.c(656)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'||':if(this.gc(0,'precLeft_',20)&&this.c(656)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'and':if(this.gc(0,'precLeft_',4)&&this.ck(656)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'or':if(this.gc(0,'precLeft_',2)&&this.ck(656)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'?':if(this.gc(0,'precLeft_',0)&&this.c(653)){ $.expr = this.applyOpToken( $.expr, '?:' ); }continue
case'<':case'=':case'>':case'!=':case'<=':case'<>':case'>=':if(this.gc(0,'precNone_',10)&&this.c(655)){ $.expr = this.applyOpToken( $.expr ); }continue
case'is':if(this.gc(0,'precNone_',10)&&this.ck(657)){ $.expr = this.applyOpToken( $.expr ); }continue
case'not':if(this.gc(0,'isNegatedRelation','10')&&this.ck(659)){ $.expr = this.applyOpToken( $.expr ); }continue
case'in':case'like':case'between':if(this.gc(0,'precNone_',10)&&this.g(659)){ $.expr = { op: { val: 'ixpr', location: this.la().location }, args: [ $.expr ] }; }continue
default:this.gr([]);continue
}
case 653:if(this.expression(_={},654)){e=_.expr; $.expr.args.push( e ); }continue
case 654:if(this.m(656,':')){ this.pushXprToken( $.expr ); }continue
case 655:switch(this.lk()){
case'all':case'any':case'some':if(this.ck(656)){ this.pushXprToken( $.expr ); }continue
default:this.s=656;continue
}
case 656:if(this.expression(_={},667)){e=_.expr; $.expr.args.push( e ); }continue
case 657:switch(this.lk()){
case'not':if(this.ck(658)){ this.pushXprToken( $.expr ); }continue
default:this.s=658;continue
}
case 658:if(this.mk(667,'null')){ this.pushXprToken( $.expr ); }continue
case 659:switch(this.lk()){
case'between':if(this.ck(660)){ this.pushXprToken( $.expr ); }continue
case'in':if(this.ck(663)){ this.pushXprToken( $.expr ); }continue
case'like':if(this.ck(664)){ this.pushXprToken( $.expr ); }continue
default:this.e();continue
}
case 660:if(this.expression(_={},661)){e=_.expr; $.expr.args?.push( e ); }continue
case 661:if(this.mk(662,'and')){ this.pushXprToken( $.expr ); }continue
case 662:if(this.expression(_={},667)){e=_.expr; $.expr.args?.push( e ); }continue
case 663:if(this.expression(_={},667)){e=_.expr; $.expr.args?.push( this.secureParens( e ) ); }continue
case 664:if(this.expression(_={},665)){e=_.expr; $.expr.args?.push( e ); }continue
case 665:switch(this.lk()){
case'escape':if(this.ck(666)){ this.pushXprToken( $.expr ); }continue
default:this.s=667;continue
}
case 666:if(this.expression(_={},667)){e=_.expr; $.expr.args?.push( e ); }continue
case 667:this.s=652;{ this.attachLocation( $.expr ); }continue
default:return this.exit_()
}
}
expressionOrQueryParens($,$next){
$.expr??=undefined
this.rule_(669,$next)
for(;;)switch(this.s){
case 669:if(this.m(670,'(')){this.queryOnLeft()}continue;
case 670:switch(this.lk()){
case'(':this.expressionOrQueryParens($,671);continue
case'Id':case'#':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression($,673)){this.queryOnLeft(0,'expr')}continue;
case'select':this.queryExpression($,674);continue
default:this.ei();continue
}
case 671:switch(this.lk()){
case'*':case'+':case'-':case'/':case'<':case'=':case'>':case'?':case'!=':case'<=':case'<>':case'>=':case'in':case'is':case'or':case'||':case'and':case'not':case'like':case'between':if(this.expression($,672,642)){this.queryOnLeft(0,'expr')}continue;
case',':if(this.continueExpressionslist($,674)){this.queryOnLeft(0,'expr')}continue;
case'limit':case'minus':case'order':case'union':case'except':case'intersect':this.gc(674,'queryOnLeft')&&this.queryExpression($,674,454);continue
default:this.s=674;continue
}
case 672:switch(this.l()){
case',':this.continueExpressionslist($,674);continue
default:this.s=674;continue
}
case 673:switch(this.l()){
case',':this.continueExpressionslist($,674);continue
default:this.s=674;continue
}
case 674:if(this.m(0,')')){ this.surroundByParens( $.expr ); }continue
default:return this.exit_()
}
}
continueExpressionslist($,$next){
let e;let _
this.rule_(676,$next)
for(;;)switch(this.s){
case 676:if(this.m(677,',')){ $.expr = { op: this.valueWithLocation( 'list' ), args: [ $.expr ], location: { ... $.expr.$parens?.at( -1 ) ?? $.expr.location } }; }continue
case 677:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=678;continue
default:this.ei();continue
}
case 678:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression(_={},679)){e=_.expr; $.expr.args.push( e ); }continue
default:this.gi(0,[')']);continue
}
case 679:switch(this.l()){
case',':this.c(678);continue
default:this.gr([')']);continue
}
case 0:{ this.attachLocation( $.expr ); }
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
newAndValuePath($,$next){
$.expr??=undefined
let e;let _
this.rule_(681,$next)
for(;;)switch(this.s){
case 681:if(this.mk(682,'new')){ $.expr = this.applyOpToken(); }continue
case 682:if(this.valuePath(_={},0)){e=_.expr; e = this.valuePathAst( e );
if (e.op?.val !== 'ixpr') $.expr.args.push( e ); else $.expr.args.push( ...e.args ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
caseExpression($,$next){
$.expr??=undefined
let e;let _
this.rule_(684,$next)
for(;;)switch(this.s){
case 684:if(this.mk(685,'case')){ $.expr.op = { val: 'ixpr', location: this.lb().location }; $.expr.args = []; this.pushXprToken( $.expr ); }continue
case 685:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression(_={},686)){e=_.expr; $.expr.args.push( e ); }continue
case'when':this.gP(686);continue
default:this.gi(686);continue
}
case 686:switch(this.lk()){
case'when':this.s=687;continue
default:this.e();continue
}
case 687:switch(this.lk()){
case'when':if(this.ck(688)){ this.pushXprToken( $.expr ); }continue
default:this.s=691;continue
}
case 688:if(this.expression(_={},689)){e=_.expr; $.expr.args.push( e ); }continue
case 689:if(this.mk(690,'then')){ this.pushXprToken( $.expr ); }continue
case 690:if(this.expression(_={},687)){e=_.expr; $.expr.args.push( e ); }continue
case 691:switch(this.lk()){
case'else':if(this.ck(692)){ this.pushXprToken( $.expr ); }continue
default:this.s=693;continue
}
case 692:if(this.expression(_={},693)){e=_.expr; $.expr.args.push( e ); }continue
case 693:if(this.mk(0,'end')){ this.pushXprToken( $.expr ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
castFunction($,$next){
$.expr??=undefined
let arg;let _
this.rule_(695,$next)
for(;;)switch(this.s){
case 695:if(this.mk(696,'cast')){ $.expr.op = this.valueWithLocation(); }continue
case 696:if(this.m(697,'(')){ $.expr.args = this.createArray(); }continue
case 697:if(this.expression(_={},698)){arg=_.expr; $.expr.args?.push( arg ); }continue
case 698:this.mk(699,'as');continue
case 699:this.typeRefOptArgs({art:$.expr},700);continue
case 700:if(this.m(0,')')){ this.finalizeDictOrArray( $.expr.args ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
argumentsAndFilter($,$next){
let open;let expr;let id;let _
this.rule_(702,$next)
for(;;)switch(this.s){
case 702:switch(this.l()){
case'(':if(this.c(703)){open=this.lb();this.prepareSpecialFunction(); $.pathStep.args = this.createArray(); }continue
default:this.s=722;continue
}
case 703:switch(this.l()){
case'Id':if(this.gc(704,'isNamedArg')&&this.ciA(710,'paramname'))id=this.lb();continue
default:this.s=704;continue
}
case 704:switch(this.l()){
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'Id_all':case'Number':case'String':case'QuotedLiteral':if(this.funcExpression(_={},705)){expr=_.expr; $.pathStep.args.push( expr ); }continue
default:this.s=721;continue
}
case 705:switch(this.l()){
case',':if(this.c(706)){this.nextFunctionArgument()}continue;
default:this.s=707;continue
}
case 706:switch(this.lk()){
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Id_all':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.funcExpression(_={},705)){expr=_.expr; $.pathStep.args.push( expr ); }continue
case')':case'order':this.gP(707);continue
default:this.ei();continue
}
case 707:switch(this.lk()){
case'order':if(this.ck(708)){ expr = $.pathStep.args[$.pathStep.args.length - 1] = this.applyOpToken( expr ); }continue
default:this.s=721;continue
}
case 708:if(this.mk(709,'by')){ this.pushXprToken( expr ); }continue
case 709:if(this.orderByClauseAsXpr({outer:expr.args},721)){ this.attachLocation( expr ); }continue
case 710:switch(this.l()){
case':':if(this.c(711)){ $.pathStep.args = this.createDict( open ); $.pathStep.$syntax = ':'; }continue
case'=>':if(this.c(716)){ $.pathStep.args = this.createDict(); }continue
default:this.e();continue
}
case 711:if(this.expression(_={},712)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 712:switch(this.l()){
case',':this.c(713);continue
default:this.s=721;continue
}
case 713:switch(this.l()){
case'Id':if(this.ciA(714,'paramname'))id=this.lb();continue
case')':this.s=721;continue
default:this.e();continue
}
case 714:this.m(715,':');continue
case 715:if(this.expression(_={},712)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 716:if(this.expression(_={},717)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 717:switch(this.l()){
case',':this.c(718);continue
default:this.s=721;continue
}
case 718:switch(this.l()){
case'Id':if(this.ciA(719,'paramname'))id=this.lb();continue
case')':this.s=721;continue
default:this.e();continue
}
case 719:this.m(720,'=>');continue
case 720:if(this.expression(_={},717)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 721:this.m(722,')');continue
case 722:switch(this.l()){
case'[':this.cardinalityAndFilter($,0);continue
default:this.gr(['*','+','-','.','/','<','=','>','?','!=','<=','<>','>=','in','is','or','||','and','not','like','between']);continue
}
default:return this.exit_()
}
}
funcExpression($,$next){
$.expr??=undefined
let args
let tok;let e;let _
this.rule_(724,$next)
for(;;)switch(this.s){
case 724:switch(this.lGenericIntroOrExpr()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'Number':case'String':case'QuotedLiteral':if(this.expression(_={},726))$.expr=_.expr;continue
case'GenericExpr':if(this.ckA(726)){tok=this.lb(); $.expr = { val: tok.keyword ?? tok.type, location: tok.location, literal: 'token' }; }continue
case'GenericIntro':if(this.ckA(725)){ $.expr = this.applyOpToken(); args = $.expr.args; }continue
default:this.e();continue
}
case 725:if(this.expression(_={},726)){e=_.expr; $.expr.args.push( e ); }continue
case 726:switch(this.lGenericSeparator()){
case'GenericSeparator':if(this.ckA(727)){ if (args) this.pushXprToken( args ); else { $.expr= this.applyOpToken( $.expr ); args = $.expr.args; } }continue
default:this.gr([')',',','order']);continue
}
case 727:switch(this.lGenericExpr()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'Number':case'String':case'QuotedLiteral':if(this.expression(_={},726)){e=_.expr; args.push( e ); }continue
case'GenericExpr':if(this.ckA(726)){ this.pushXprToken( args ); }continue
default:this.e();continue
}
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
overClause($,$next){
let over=[]
this.rule_(729,$next)
for(;;)switch(this.s){
case 729:this.m(730,'(');continue
case 730:switch(this.lk()){
case'partition':if(this.ck(731)){ this.pushXprToken( over ); }continue
default:this.s=733;continue
}
case 731:if(this.mk(732,'by')){ this.pushXprToken( over ); }continue
case 732:this.expressionsAsXpr({outer:over},733);continue
case 733:switch(this.lk()){
case'order':if(this.ck(734)){ this.pushXprToken( over ); }continue
default:this.s=736;continue
}
case 734:if(this.mk(735,'by')){ this.pushXprToken( over ); }continue
case 735:this.orderByClauseAsXpr({outer:over},736);continue
case 736:switch(this.lk()){
case'rows':if(this.ck(737)){ this.pushXprToken( over ); }continue
default:this.s=738;continue
}
case 737:this.windowFrameClause({outer:over},738);continue
case 738:this.m(0,')');continue
default:
$.outer.push( this.surroundByParens( this.ixprAst( over ) ) )
return this.exit_()
}
}
expressionsAsXpr($,$next){
let args=[]
let expr;let _
this.rule_(740,$next)
for(;;)switch(this.s){
case 740:if(this.expression(_={},741)){expr=_.expr; args.push( expr ); }continue
case 741:switch(this.l()){
case',':if(this.c(742)){ this.pushXprToken( args ); }continue
default:this.gr([')','rows','order']);continue
}
case 742:if(this.expression(_={},741)){expr=_.expr; args.push( expr ); }continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
orderByClauseAsXpr($,$next){
let args=[]
this.rule_(744,$next)
for(;;)switch(this.s){
case 744:this.orderBySpecAsXpr({args},745);continue
case 745:switch(this.l()){
case',':if(this.c(746)){ this.pushXprToken( args ); }continue
default:this.gr([')']);continue
}
case 746:this.orderBySpecAsXpr({args},745);continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
orderBySpecAsXpr($,$next){
let expr;let _
this.rule_(748,$next)
for(;;)switch(this.s){
case 748:if(this.expression(_={},749)){expr=_.expr; $.args.push( expr ); }continue
case 749:switch(this.lk()){
case'asc':case'desc':if(this.ck(750)){ this.pushXprToken( $.args ); }continue
default:this.s=750;continue
}
case 750:switch(this.lk()){
case'nulls':if(this.ck(751)){ this.pushXprToken( $.args ); }continue
default:this.gr([')',',']);continue
}
case 751:switch(this.lk()){
case'last':case'first':if(this.ck(0)){ this.pushXprToken( $.args ); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
windowFrameClause($,$next){
let args=[]
this.rule_(753,$next)
for(;;)switch(this.s){
case 753:switch(this.lk()){
case'unbounded':if(this.ck(754)){ this.pushXprToken( args ); }continue
case'Number':if(this.c(754)){ args.push( this.unsignedIntegerLiteral() ); }continue
case'current':if(this.ck(755)){ this.pushXprToken( args ); }continue
case'between':if(this.ck(756)){ this.pushXprToken( args ); }continue
default:this.e();continue
}
case 754:if(this.mk(0,'preceding')){ this.pushXprToken( args ); }continue
case 755:if(this.mk(0,'row')){ this.pushXprToken( args ); }continue
case 756:this.windowFrameBoundSpec({args},757);continue
case 757:if(this.mk(758,'and')){ this.pushXprToken( args ); }continue
case 758:this.windowFrameBoundSpec({args},0);continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
windowFrameBoundSpec($,$next){
this.rule_(760,$next)
for(;;)switch(this.s){
case 760:switch(this.lk()){
case'unbounded':if(this.ck(761)){ this.pushXprToken( $.args ); }continue
case'Number':if(this.c(761)){ $.args.push( this.unsignedIntegerLiteral() ); }continue
case'current':if(this.ck(763)){ this.pushXprToken( $.args ); }continue
default:this.e();continue
}
case 761:switch(this.lk()){
case'following':this.ck(762);continue
case'preceding':this.ck(762);continue
default:this.e();continue
}
case 762:if(this.gr([])){ this.pushXprToken( $.args ); }continue
case 763:if(this.mk(0,'row')){ this.pushXprToken( $.args ); }continue
default:return this.exit_()
}
}
literalValue($,$next){
$.expr??={}
this.rule_(765,$next)
for(;;)switch(this.s){
case 765:switch(this.lk()){
case'#':if(this.c(766)){ this.reportUnexpectedSpace(); }continue
case'null':if(this.ck(0)){ $.expr = { literal: 'null', val: null }; }continue
case'true':case'false':if(this.ck(0)){ $.expr = { literal: 'boolean', val: this.lb().keyword === 'true' }; }continue
case'Number':if(this.c(0)){ $.expr = this.numberLiteral(); }continue
case'String':if(this.c(0)){ $.expr = this.quotedLiteral(); }continue
case'QuotedLiteral':if(this.c(0)){ $.expr = this.quotedLiteral(); }continue
default:this.e();continue
}
case 766:if(this.mi(0,'enumref')){ $.expr = { literal: 'enum', sym: this.identAst() } }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
annoAssignStd($,$next){
this.rule_(768,$next)
for(;;)switch(this.s){
case 768:if(this.m(769,'@')){this.annoInSameLine(); this.reportUnexpectedSpace(); }continue
case 769:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':this.annoAssignBase($,0);continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignCol($,$next){
this.rule_(771,$next)
for(;;)switch(this.s){
case 771:if(this.m(772,'@')){ this.reportUnexpectedSpace(); }continue
case 772:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':this.annoAssignBase($,0);continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignMid($,$next){
let name;let _
this.rule_(774,$next)
for(;;)switch(this.s){
case 774:if(this.m(775,'@')){this.annoInSameLine(); this.reportUnexpectedSpace(); }continue
case 775:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':if(this.annoNamePath(_={category:'anno'},0)){name=_.name; this.assignAnnotation( $.art, {}, name ); this.warnIfColonFollows( name ); }continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignParen($,$next){
this.rule_(777,$next)
for(;;)switch(this.s){
case 777:if(this.m(778,'(')){this.annoInSameLine()}continue;
case 778:switch(this.l()){
case'Id':this.annoAssignBase({art:$.art},779);continue
default:this.s=780;continue
}
case 779:switch(this.l()){
case',':this.c(778);continue
case')':this.s=780;continue
default:this.e();continue
}
case 780:this.m(0,')');continue
default:return this.exit_()
}
}
annoAssignBase($,$next){
let value={}
let name;let _
this.rule_(782,$next)
for(;;)switch(this.s){
case 782:if(this.annoNamePath(_={category:'anno'},783))name=_.name;continue
case 783:switch(this.l()){
case':':this.gc(0,'annoInSameLine')&&this.c(784);continue
default:this.gr([]);continue
}
case 784:if(this.annoValue(_={},0))value=_.value;continue
default:
this.assignAnnotation( $.art, value, name || {} )
return this.exit_()
}
}
annoNamePath($,$next){
$.name??=new XsnName()
let at
this.rule_(786,$next)
for(;;)switch(this.s){
case 786:if(this.miA(787,$.category)){ $.name.path = [ this.identAst() ]; }continue
case 787:switch(this.l()){
case'.':this.c(788);continue
default:this.s=790;continue
}
case 788:switch(this.l()){
case'Id':if(this.ciA(787,$.category)){ $.name.path.push( this.identAst() ); }continue
case'@':if(this.c(789))at=this.lb();continue
default:this.e();continue
}
case 789:if(this.miA(787,$.category)){ $.name.path.push( this.identAstWithPrefix( at ) ); }continue
case 790:switch(this.l()){
case'#':this.gc(0,'annoInSameLine')&&this.annoPathVariant({nameOrRef:$.name},0);continue
default:this.gr([]);continue
}
default:
this.attachLocation( $.name )
return this.exit_()
}
}
annoPath($,$next){
let at
this.rule_(792,$next)
for(;;)switch(this.s){
case 792:switch(this.l()){
case'Id':if(this.ciA(794,$.category)){ $.nameOrRef.path = [ this.identAst() ]; }continue
case'@':if(this.c(793))at=this.lb();continue
default:this.e();continue
}
case 793:if(this.miA(794,$.category)){ $.nameOrRef.path = [ this.identAstWithPrefix( at ) ]; }continue
case 794:switch(this.l()){
case'.':this.c(795);continue
default:this.s=797;continue
}
case 795:switch(this.l()){
case'Id':if(this.ciA(794,$.category)){ $.nameOrRef.path.push( this.identAst() ); }continue
case'@':if(this.c(796))at=this.lb();continue
default:this.e();continue
}
case 796:if(this.miA(794,$.category)){ $.nameOrRef.path.push( this.identAstWithPrefix( at ) ); }continue
case 797:switch(this.l()){
case'#':this.annoPathVariant({nameOrRef:$.nameOrRef},0);continue
default:this.gr([]);continue
}
default:
this.attachLocation( $.nameOrRef )
return this.exit_()
}
}
annoPathVariant($,$next){
this.rule_(799,$next)
for(;;)switch(this.s){
case 799:if(this.m(800,'#')){ this.reportUnexpectedSpace(); }continue
case 800:if(this.miA(801,'variant')){ $.nameOrRef.variant = { path: [ this.identAst() ] }; }continue
case 801:switch(this.l()){
case'.':this.c(802);continue
default:this.gr([]);continue
}
case 802:if(this.miA(801,'variant')){ $.nameOrRef.variant.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.nameOrRef.variant )
return this.exit_()
}
}
annoStructValue($,$next){
$.value??={}
let name=new XsnName()
let _
this.rule_(804,$next)
for(;;)switch(this.s){
case 804:if(this.annoPath({nameOrRef:name,category:'name'},805)){ this.attachLocation( name ); }continue
case 805:switch(this.l()){
case':':this.c(806);continue
default:if(this.gr([',','}'])){ this.attachLocation( $.value ); }continue
}
case 806:if(this.annoValue(_={},0))$.value=_.value;continue
default:
$.value.name = name
return this.exit_()
}
}
annoValue($,$next){
$.value??={}
let sign;let sub;let ellipsis;let upTo;let _
this.rule_(808,$next)
for(;;)switch(this.s){
case 808:switch(this.lk()){
case'#':case'null':case'true':case'false':case'Number':case'String':case'QuotedLiteral':if(this.literalValue(_={},0)){$.value=_.expr; this.adjustAnnoNumber( $.value ); }continue
case'+':case'-':if(this.c(809))sign=this.lb();continue
case'Id':case'@':this.annoPath({nameOrRef:$.value,category:'annoref'},0);continue
case'{':if(this.c(810)){ if (!this.dynamic_.arrayAnno) $.value.$flatten = [];
else { $.value.struct = Object.create(null); $.value.literal = 'struct'; } }continue
case'[':if(this.c(814)){this.arrayAnno(); $.value.val = []; $.value.literal = 'array' }continue
case'(':this.c(821);continue
default:this.ei();continue
}
case 809:if(this.m(0,'Number')){ this.adjustAnnoNumber( $.value = this.numberLiteral( sign ) ); }continue
case 810:switch(this.l()){
case'Id':case'@':if(this.annoStructValue(_={},811)){sub=_.value; if ($.value.$flatten) $.value.$flatten.push( sub );
else this.addDef( sub, $.value, 'struct', null, sub.name ); }continue
default:this.s=812;continue
}
case 811:switch(this.l()){
case',':this.c(810);continue
case'}':this.s=812;continue
default:this.e();continue
}
case 812:this.s=813;{ this.ec( 'arrayAnno', 'orNotEmpty' ); }continue
case 813:this.m(0,'}');continue
case 814:switch(this.l()){
case'Id':case'#':case'(':case'+':case'-':case'@':case'[':case'{':case'Number':case'String':case'QuotedLiteral':if(this.annoValue(_={},819)){sub=_.value; $.value.val.push( sub ) }continue
case'...':if(this.gc(820,'arrayAnno','ellipsis')&&this.c(815))ellipsis=this.lb();continue
default:this.s=820;continue
}
case 815:switch(this.lk()){
case'up':this.ck(816);continue
default:this.s=818;{ upTo = undefined; }continue
}
case 816:this.mk(817,'to');continue
case 817:if(this.annoValue(_={},818))upTo=_.value;continue
case 818:this.s=819;{ $.value.val.push( { literal: 'token', val: '...', location: ellipsis.location, upTo: upTo } ); }continue
case 819:switch(this.l()){
case',':this.c(814);continue
case']':this.s=820;continue
default:this.e();continue
}
case 820:this.m(0,']');continue
case 821:if(this.condition(_={},822))$.value=_.expr;continue
case 822:if(this.m(0,')')){ $.value.$tokenTexts = this.ruleTokensText(); }continue
default:
this.attachLocation( $.value )
return this.exit_()
}
}
}
module.exports = { CdlParser }
